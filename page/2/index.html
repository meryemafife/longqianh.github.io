<!DOCTYPE html>


<html lang="en">


<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8" />
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
     Peter&#39;s Blog
  </title>
  <meta name="generator" content="hexo-theme-ayer">
  
  <link rel="shortcut icon" href="/ironman.ico" />
  
  
<link rel="stylesheet" href="/dist/main.css">

  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css">

  
<link rel="stylesheet" href="/css/custom.css">

  
  
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

  
  

  

</head>

</html>

<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="app">
    <main class="content on">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://github.com/longqianh"
        target="_blank"><img width="149" height="149" src="/images/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/IDR_THEME_NTP_BACKGROUND.png" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">Peter&#39;s Blog</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script>

<div id="main">
  <section class="outer">
  <article class="articles">
    
    
    
    
    <article id="post-Computer-Science-Machine-Learning-TensorFlow-Notes" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/05/05/Computer-Science-Machine-Learning-TensorFlow-Notes/"
    >TensorFlow Notes</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/05/05/Computer-Science-Machine-Learning-TensorFlow-Notes/" class="article-date">
  <time datetime="2020-05-05T13:18:07.000Z" itemprop="datePublished">2020-05-05</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Computer-Science/">Computer Science</a> / <a class="article-category-link" href="/categories/Computer-Science/Machine-Learning/">Machine Learning</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <p>This is my notes for TensorFlow.</p>
<p>推荐网站：</p>
<ul>
<li><a href="tf.wiki">简单粗暴 TensorFlow 2</a></li>
<li><a href="https://keras.io/zh/" target="_blank" rel="noopener">Keras 中文文档</a></li>
</ul>
<h1 id="tensorflow-学习笔记">TensorFlow 学习笔记</h1>
<h2 id="数学基础部分">1. 数学基础部分</h2>
<h3 id="损失函数交叉熵">损失函数：交叉熵</h3>
<p><a href="https://blog.csdn.net/tsyccnh/article/details/79163834" target="_blank" rel="noopener">参考文章：深入理解交叉熵</a></p>
<ol type="1">
<li><p>来源 ：信息论</p></li>
<li><p>信息量:</p></li>
</ol>
<p><span class="math display">\[
I(x)=-\ln \left[p(x)\right]
\]</span></p>
<p>衡量事件 <span class="math inline">\(X=x\)</span> 包含信息的多少，发生概率越小，信息量越大。</p>
<ol start="3" type="1">
<li>信息熵：</li>
</ol>
<p><span class="math display">\[
H(X)=E\left[I(X)\right]=-\sum_{i=1}^n p(x_i)\ln\left[p(x_i)\right]
\]</span></p>
<p>事件包含的信息量的期望。</p>
<ol start="4" type="1">
<li>相对熵：KL divergence <span class="math display">\[
D_{KL}(A\| B)=-\sum_{i=1}^n p_A(x_i)\ln\left[\frac{p_A(x_i)}{p_B(x_i)}\right]
\]</span></li>
</ol>
<p><span class="math inline">\(A\)</span> 与 <span class="math inline">\(B\)</span> 之间的对数差（即是信息量的差）在 <span class="math inline">\(A\)</span> 上的期望值。</p>
<p>理解：相对熵在数学上为 <span class="math inline">\(A\)</span> 和<span class="math inline">\(B\)</span> 对数差的期望，进一步可以看成是 <strong><span class="math inline">\(B\)</span> 对<span class="math inline">\(A\)</span> 的信息量的差的期望</strong>。非常符合直觉。</p>
<ol start="5" type="1">
<li>交叉熵 <span class="math display">\[
\begin{align}
D_{KL}(A\|B)&amp;=-\sum_{i=1}^n p_A(x_i)\ln\left[p_A(x_i)\right]+\sum_{i=1}^n p_A(x_i)\ln\left[ p_B(x_i)\right]\\
&amp;=H(A)+H(A,B)
\end{align}
\]</span></li>
</ol>
<p>后一项 <span class="math inline">\(H(A,B)\)</span> 就是交叉熵： <span class="math display">\[
H(A,B)=\sum_{i=1}^np_A(x_i)\ln\left[p_B(x_i)\right]
\]</span></p>
<ol start="6" type="1">
<li>应用</li>
</ol>
<p>机器学习中，<span class="math inline">\(A\)</span> 为真实分布，<span class="math inline">\(B\)</span> 为预测分布。由于 <span class="math inline">\(A\)</span> 的信息量是不变的，相对熵中可以只关注交叉熵。交叉熵作为损失函数很好地衡量信息量的差。</p>
<p>线性回归问题中均方误差 <span class="math inline">\(MSE\)</span> 比较好用，在<strong>逻辑分类问题</strong>中交叉熵更加符合直觉。</p>
<h2 id="算法基础部分">2. 算法基础部分</h2>
<h3 id="adam">Adam</h3>
<p>待办：研究论文的数学部分</p>
<p><a href="https://blog.csdn.net/willduan1/article/details/78070086" target="_blank" rel="noopener">参考网站</a></p>
<p>理解：更好地更新权重参数</p>
<p>应用：Well suited for problems that are large in terms of data and/or parameters. The method is also appropriate for non-stationary objectives and problems with very noisy and/or sparse gradients.</p>
<h3 id="cross-validation">Cross Validation</h3>
<p>交叉验证。将数据集打乱分成 <span class="math inline">\(k\)</span> 份不相交的集合，循环训练 <span class="math inline">\(k\)</span> 次，第 <span class="math inline">\(i\)</span> 次用除了第 <span class="math inline">\(i\)</span> 集合的部分训练，用第 <span class="math inline">\(i\)</span> 集合计算损失函数，最后的损失函数为所有损失的平均。</p>
<p>待办：这种做法的合理性和优越性</p>
<p>K-fold cross-validation procedure</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 算法伪代码</span></span><br><span class="line">Define KFoldXV(D,A,L,k)<span class="symbol">:</span></span><br><span class="line"><span class="symbol">Require:</span> D the given dataset</span><br><span class="line"><span class="symbol">Require:</span> A the learning algorithm, seen as a function that takes a dataset as input <span class="keyword">and</span> outputs a learned function</span><br><span class="line"><span class="symbol">Require:</span> L the loss function, map the chosen test example to a scalar</span><br><span class="line"><span class="symbol">Require:</span> k the number of folds</span><br><span class="line">	</span><br><span class="line">	Split D into k mutually exclusive subsets D_i, whose union is D</span><br><span class="line">	<span class="keyword">for</span> i from <span class="number">1</span> to k <span class="keyword">do</span></span><br><span class="line">    f_i = A(D\D_i) <span class="comment"># 用第i个集合之外的训练</span></span><br><span class="line">    <span class="keyword">for</span> z_j <span class="keyword">in</span> D_i <span class="keyword">do</span></span><br><span class="line">      e_j = L(f_i,z_j) <span class="comment"># 用第i个集合计算损失</span></span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">for</span></span><br><span class="line">  <span class="keyword">end</span> <span class="keyword">for</span></span><br><span class="line">	Return e</span><br></pre></td></tr></table></figure>
<h3 id="lstm">LSTM</h3>
<p><a href="https://zhuanlan.zhihu.com/p/32085405" target="_blank" rel="noopener">参考</a></p>
<p>长短期记忆（Long short-term memory, LSTM）是一种特殊的RNN，主要是为了解决长序列训练过程中的梯度消失和梯度爆炸问题。</p>
<p>待办：关于激活函数 <span class="math inline">\(\tanh\)</span></p>
<h2 id="代码基础部分">3. 代码基础部分</h2>
<p>慢慢填。</p>
<h3 id="变量与常量">变量与常量</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = tf.constant([[<span class="number">1.0</span>]])</span><br></pre></td></tr></table></figure>
<p>注意需转化为张量（or：矩阵），外面多套一层括号。</p>
<h3 id="tf中的函数">TF中的函数</h3>
<h4 id="tf.one_hot">tf.one_hot</h4>
<p><code>tf.one_hot</code> 将输入数组转化为”one-hot“型的输出。和单分类问题有这非常密切的联系（待挖掘）。</p>
<p>比如：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">-- 输入 --</span><br><span class="line">x=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">2</span>] <span class="comment"># 根据输出 -1 表示不属于任何一类</span></span><br><span class="line">print(tf.one_hot(x,depth=<span class="number">6</span>)) <span class="comment"># depth 应该是总分类数</span></span><br><span class="line"></span><br><span class="line">-- 输出 --</span><br><span class="line">tf.Tensor(</span><br><span class="line">[[<span class="number">1.</span> <span class="number">0.</span> <span class="number">0.</span> <span class="number">0.</span> <span class="number">0.</span> <span class="number">0.</span>]</span><br><span class="line"> [<span class="number">0.</span> <span class="number">1.</span> <span class="number">0.</span> <span class="number">0.</span> <span class="number">0.</span> <span class="number">0.</span>]</span><br><span class="line"> [<span class="number">0.</span> <span class="number">0.</span> <span class="number">0.</span> <span class="number">0.</span> <span class="number">0.</span> <span class="number">0.</span>]</span><br><span class="line"> [<span class="number">0.</span> <span class="number">0.</span> <span class="number">1.</span> <span class="number">0.</span> <span class="number">0.</span> <span class="number">0.</span>]], shape=(<span class="number">4</span>, <span class="number">6</span>), dtype=float32)</span><br></pre></td></tr></table></figure>
<h4 id="tf.image">tf.image</h4>
<p>用于图像处理，可以用这个扩充数据集。</p>
<p><a href="%5Bhttps://medium.com/@lufor129/tensorflow-%E5%9C%96%E7%89%87%E6%95%B8%E6%93%9A%E5%A2%9E%E5%BC%B7-%E4%BA%8C-%E5%9C%96%E7%89%87%E8%99%95%E7%90%86%E5%87%BD%E6%95%B8-1083fb176f9%5D(https://medium.com/@lufor129/tensorflow-圖片數據增強-二-圖片處理函數-1083fb176f9)">推荐/待继续研究</a></p>
<h4 id="tfds.load">tfds.load</h4>
<p>载入数据。<code>split</code> <a href="https://www.tensorflow.org/datasets/splits" target="_blank" rel="noopener">有很多玩法</a>。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow_datasets <span class="keyword">as</span> tfds</span><br><span class="line">mnist_dataset, mnist_info = tfda.load(<span class="string">'mnist'</span>,split=<span class="string">'train'</span>,\</span><br><span class="line">               with_info=<span class="literal">True</span>,batch_size=<span class="literal">None</span>,\</span><br><span class="line">               shuffle_files=<span class="literal">True</span>, as_supvised=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重要参数</span></span><br><span class="line"><span class="comment"># split :  Which split of the data to load (e.g. 'train', 'test' ['train', 'test'], 'train[80%:]')</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># shuffle_files </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># as_supvised : bool, if True, the returned tf.data.Dataset will have a 2-tuple structure (input, label)</span></span><br><span class="line"><span class="comment"># batch_size : add a batch dimension to examples</span></span><br><span class="line"></span><br><span class="line">mnist_train = mnist_dataset[<span class="string">'train'</span>]</span><br><span class="line"><span class="comment"># 返回迭代器(generator ) mnist_train</span></span><br><span class="line"></span><br><span class="line">print(mnist_info)</span><br><span class="line"><span class="comment"># 数据集信息</span></span><br><span class="line"></span><br><span class="line">-- result --</span><br><span class="line"></span><br><span class="line">tfds.core.DatasetInfo(</span><br><span class="line">    name=<span class="string">'mnist'</span>,</span><br><span class="line">    version=<span class="number">3.0</span><span class="number">.1</span>,</span><br><span class="line">    description=<span class="string">'The MNIST database of handwritten digits.'</span>,</span><br><span class="line">    homepage=<span class="string">'http://yann.lecun.com/exdb/mnist/'</span>,</span><br><span class="line">    features=FeaturesDict(&#123;</span><br><span class="line">        <span class="string">'image'</span>: Image(shape=(<span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>), dtype=tf.uint8),</span><br><span class="line">        <span class="string">'label'</span>: ClassLabel(shape=(), dtype=tf.int64, num_classes=<span class="number">10</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    total_num_examples=<span class="number">70000</span>,</span><br><span class="line">    splits=&#123;</span><br><span class="line">        <span class="string">'test'</span>: <span class="number">10000</span>,</span><br><span class="line">        <span class="string">'train'</span>: <span class="number">60000</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    supervised_keys=(<span class="string">'image'</span>, <span class="string">'label'</span>),</span><br><span class="line">    citation=<span class="string">"""@article&#123;lecun2010mnist,</span></span><br><span class="line"><span class="string">      title=&#123;MNIST handwritten digit database&#125;,</span></span><br><span class="line"><span class="string">      author=&#123;LeCun, Yann and Cortes, Corinna and Burges, CJ&#125;,</span></span><br><span class="line"><span class="string">      journal=&#123;ATT Labs [Online]. Available: http://yann. lecun. com/exdb/mnist&#125;,</span></span><br><span class="line"><span class="string">      volume=&#123;2&#125;,</span></span><br><span class="line"><span class="string">      year=&#123;2010&#125;</span></span><br><span class="line"><span class="string">    &#125;"""</span>,</span><br><span class="line">    redistribution_info=,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="tf.constant_initializer">tf.constant_initializer</h4>
<p>用于初始化权重矩阵。</p>
<p>待解决：如何查看初始化的矩阵的内容</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">W = np.array([[</span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">-1</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">-2</span>, <span class="number">0</span>, <span class="number">2</span>]</span><br><span class="line">]], dtype=np.float32)</span><br><span class="line">kernel_initializer = tf.constant_initializer(W)</span><br><span class="line"></span><br><span class="line">print(kernel_initializer)</span><br><span class="line"></span><br><span class="line">-- result --</span><br><span class="line">&lt;tensorflow.python.ops.init_ops_v2.Constant object at <span class="number">0x135f09810</span>&gt;</span><br></pre></td></tr></table></figure>
<h2 id="模型搭建与训练">4. 模型搭建与训练</h2>
<h3 id="线性回归">线性回归</h3>
<h4 id="搭模型">搭模型</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 模版</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyModel</span><span class="params">(tf.keras.Model)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super().__init__()     <span class="comment"># Python 2 下使用 super(MyModel, self).__init__()</span></span><br><span class="line">        <span class="comment"># 此处添加初始化代码（包含 call 方法中会用到的层），例如</span></span><br><span class="line">        <span class="comment"># layer1 = tf.keras.layers.BuiltInLayer(...)</span></span><br><span class="line">        <span class="comment"># layer2 = MyCustomLayer(...)</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">call</span><span class="params">(self, input)</span>:</span></span><br><span class="line">        <span class="comment"># 此处添加模型调用的代码（处理输入并返回输出），例如</span></span><br><span class="line">        <span class="comment"># x = layer1(input)</span></span><br><span class="line">        <span class="comment"># output = layer2(x)</span></span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"><span class="comment"># 线性模型</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Linear</span><span class="params">(tf.keras.Model)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super().__init__() <span class="comment"># Python 3 直接 super(). 就可以了</span></span><br><span class="line">        <span class="comment"># 全连接层 训练的参数为矩阵A和b : y = AX+b</span></span><br><span class="line">        self.dense = tf.keras.layers.Dense(</span><br><span class="line">            units=<span class="number">1</span>, <span class="comment"># 输出的最后一维 feature的层数</span></span><br><span class="line">            activation=<span class="literal">None</span>,</span><br><span class="line">	          <span class="comment"># 设置 Keras 各层权重随机初始值</span></span><br><span class="line">            kernel_initializer=tf.zeros_initializer(),</span><br><span class="line">            bias_initializer=tf.zeros_initializer()</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">call</span><span class="params">(self, input)</span>:</span></span><br><span class="line">        output = self.dense(input)</span><br><span class="line">        <span class="keyword">return</span> output</span><br></pre></td></tr></table></figure>
<h4 id="训练模型">训练模型</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 手动预处理</span></span><br><span class="line">X_raw = np.array([<span class="number">2013</span>, <span class="number">2014</span>, <span class="number">2015</span>, <span class="number">2016</span>, <span class="number">2017</span>], dtype=np.float32)</span><br><span class="line">y_raw = np.array([<span class="number">12000</span>, <span class="number">14000</span>, <span class="number">15000</span>, <span class="number">16500</span>, <span class="number">17500</span>], dtype=np.float32)</span><br><span class="line"></span><br><span class="line">X = (X_raw - X_raw.min()) / (X_raw.max() - X_raw.min())</span><br><span class="line">y = (y_raw - y_raw.min()) / (y_raw.max() - y_raw.min())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 训练</span></span><br><span class="line">num_epoch = <span class="number">10000</span></span><br><span class="line">model = Linear()</span><br><span class="line">optimizer = tf.keras.optimizers.SGD(learning_rate=<span class="number">0.01</span>)</span><br><span class="line">X = tf.constant([X])  <span class="comment"># X 是向量, [X] 是矩阵,可以转为张量</span></span><br><span class="line">y = tf.constant([y])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(num_epoch):</span><br><span class="line">    <span class="keyword">with</span> tf.GradientTape() <span class="keyword">as</span> tape: <span class="comment"># 开始记录梯度</span></span><br><span class="line">        y_pred = model(X)</span><br><span class="line">        loss = tf.reduce_mean(tf.square(y_pred - y)) </span><br><span class="line">        <span class="comment"># 均方误差 reduce_mean 对所有tensor所有元素求平均</span></span><br><span class="line"></span><br><span class="line">    grads = tape.gradient(loss, model.variables) <span class="comment"># 对损失函数的每一个变量求偏导</span></span><br><span class="line">    optimizer.apply_gradients(grads_and_vars=zip(grads, model.variables))</span><br><span class="line">    <span class="comment">#  apply_gradient 根据得到的梯度更新参数 传入一个list : [(grad_1,var_1),</span></span><br><span class="line">    <span class="comment"># (grad_2,var_2),...,(grad_n,var_n)]</span></span><br><span class="line">print(y_pred)</span><br></pre></td></tr></table></figure>
<h4 id="评估模型">评估模型</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sparse_categorical_accuracy = tf.keras.metrics.SparseCategoricalAccuracy()</span><br><span class="line">num_batches = int(data_loader.num_test_data // batch_size)</span><br><span class="line"><span class="keyword">for</span> batch_index <span class="keyword">in</span> range(num_batches):</span><br><span class="line">    start_index, end_index = batch_index * \</span><br><span class="line">        batch_size, (batch_index + <span class="number">1</span>) * batch_size</span><br><span class="line">    y_pred = model.predict(data_loader.test_data[start_index: end_index])</span><br><span class="line">    sparse_categorical_accuracy.update_state(</span><br><span class="line">        y_true=data_loader.test_label[start_index: end_index], y_pred=y_pred)</span><br><span class="line">print(<span class="string">"test accuracy: %f"</span> % sparse_categorical_accuracy.result())</span><br></pre></td></tr></table></figure>
<h3 id="卷积神经网络">卷积神经网络</h3>
<p><code>tfwiki</code> 讲的特别好。理解卷积核<span class="math inline">\((filter)\)</span>减少参数的作用，通过滑动（卷积）扫描整个图像，过程中的权重参数是同一个核的，就是所谓的共享权重。</p>
<p>有关卷积的动态示例可以到<a href="https://github.com/vdumoulin/conv_arithmetic" target="_blank" rel="noopener">这里</a>。有时间学一下他的<code>tex</code>代码。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CNN</span><span class="params">(tf.keras.Model)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.conv1 = tf.keras.layers.Conv2D(</span><br><span class="line">            filters=<span class="number">32</span>,             <span class="comment"># 卷积层神经元（卷积核）数目 </span></span><br><span class="line">            kernel_size=[<span class="number">5</span>, <span class="number">5</span>],     <span class="comment"># 感受野大小</span></span><br><span class="line">            padding=<span class="string">'same'</span>,         <span class="comment"># padding策略（vaild 或 same）</span></span><br><span class="line">            activation=tf.nn.relu   <span class="comment"># 激活函数</span></span><br><span class="line">        )</span><br><span class="line">        self.pool1 = tf.keras.layers.MaxPool2D(pool_size=[<span class="number">2</span>, <span class="number">2</span>], strides=<span class="number">2</span>)</span><br><span class="line">        <span class="comment"># 横向和纵向都是每两个取一个最大的，因此大小变化像这样：28,28 -&gt; 14,14</span></span><br><span class="line">        self.conv2 = tf.keras.layers.Conv2D(</span><br><span class="line">            filters=<span class="number">64</span>,</span><br><span class="line">            kernel_size=[<span class="number">5</span>, <span class="number">5</span>],</span><br><span class="line">            padding=<span class="string">'same'</span>, <span class="comment"># 'same' 策略保证卷积前后大小相同</span></span><br><span class="line">            activation=tf.nn.relu</span><br><span class="line">        )</span><br><span class="line">        self.pool2 = tf.keras.layers.MaxPool2D(pool_size=[<span class="number">2</span>, <span class="number">2</span>], strides=<span class="number">2</span>)</span><br><span class="line">        self.flatten = tf.keras.layers.Reshape(target_shape=(<span class="number">7</span> * <span class="number">7</span> * <span class="number">64</span>,))</span><br><span class="line">        self.dense1 = tf.keras.layers.Dense(units=<span class="number">1024</span>, activation=tf.nn.relu)</span><br><span class="line">        self.dense2 = tf.keras.layers.Dense(units=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">call</span><span class="params">(self, inputs)</span>:</span></span><br><span class="line">        x = self.conv1(inputs)                  <span class="comment"># [batch_size, 28, 28, 32]</span></span><br><span class="line">        x = self.pool1(x)                       <span class="comment"># [batch_size, 14, 14, 32]</span></span><br><span class="line">        x = self.conv2(x)                       <span class="comment"># [batch_size, 14, 14, 64]</span></span><br><span class="line">        x = self.pool2(x)                       <span class="comment"># [batch_size, 7, 7, 64]</span></span><br><span class="line">        x = self.flatten(x)                     <span class="comment"># [batch_size, 7 * 7 * 64]</span></span><br><span class="line">        x = self.dense1(x)                      <span class="comment"># [batch_size, 1024]</span></span><br><span class="line">        x = self.dense2(x)                      <span class="comment"># [batch_size, 10]</span></span><br><span class="line">        output = tf.nn.softmax(x)</span><br><span class="line">        <span class="keyword">return</span> output</span><br></pre></td></tr></table></figure>
<p>待看：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">kernel_initializer=tf.constant_initializer(W),</span><br><span class="line">bias_initializer=tf.constant_initializer(b)</span><br><span class="line">      </span><br><span class="line"></span><br><span class="line">dataset = dataset.map(<span class="keyword">lambda</span> img, label: (tf.image.resize(img, [<span class="number">224</span>, <span class="number">224</span>]) / <span class="number">255.0</span>, label)).shuffle(<span class="number">1024</span>).batch(<span class="number">32</span>)</span><br><span class="line">model = tf.keras.applications.MobileNetV2(weights=<span class="literal">None</span>, classes=<span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<h2 id="tf.data">tf.data</h2>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TensorFlow/" rel="tag">TensorFlow</a></li></ul>


    </footer>

  </div>

  

  

  
  
  

</article>
    
    <article id="post-Projects-Laser-holography" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/05/03/Projects-Laser-holography/"
    >Laser Holography</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/05/03/Projects-Laser-holography/" class="article-date">
  <time datetime="2020-05-02T19:00:58.000Z" itemprop="datePublished">2020-05-03</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Projects/">Projects</a> / <a class="article-category-link" href="/categories/Projects/Optics/">Optics</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <p>This is the my final report for Semiconductor Laser Holography experiement in physics experiment course.</p>
<p>I did the experiment with my dear roommates Yiheng Mao and Weiming Zhou, under the guidance of teacher Xing Chen.</p>


	<div class="row">
    <embed src="/pdf_files/半导体激光全息实验总结.pdf" width="100%" height="550" type="application/pdf">
	</div>




      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  

  
  
  

</article>
    
    <article id="post-Projects-Optomechanical-Structural-Design" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/05/03/Projects-Optomechanical-Structural-Design/"
    >Optomechanical Structural Design</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/05/03/Projects-Optomechanical-Structural-Design/" class="article-date">
  <time datetime="2020-05-02T18:25:25.000Z" itemprop="datePublished">2020-05-03</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Projects/">Projects</a> / <a class="article-category-link" href="/categories/Projects/Optics/">Optics</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <p>This is the major assignment for our optomechanical structural design course. Thanks a lot for Xiaowen Wang, Longxun Cao and Hanmo Mei. That week we all had little time for sleep and we finally made a really big guy! Although that period was very hard , I really cherish it.</p>
<p>I will make it more detailed when I have time.</p>
<h3 id="工程图汇总">工程图汇总</h3>


	<div class="row">
    <embed src="/pdf_files/钢铁侠手臂台灯-工程图汇总.pdf" width="100%" height="550" type="application/pdf">
	</div>



<h3 id="设计文件">设计文件</h3>


	<div class="row">
    <embed src="/pdf_files/钢铁侠手臂台灯项目设计文件.pdf" width="100%" height="550" type="application/pdf">
	</div>




      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  

  
  
  

</article>
    
    <article id="post-Notes-byhand-NA-notes" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/05/03/Notes-byhand-NA-notes/"
    >NA-Notes</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/05/03/Notes-byhand-NA-notes/" class="article-date">
  <time datetime="2020-05-02T18:12:18.000Z" itemprop="datePublished">2020-05-03</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/notes/">notes</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <p>This is my class notes for Numerical Analysis. Hopefully one day I can organize it into an electronic version.</p>


	<div class="row">
    <embed src="/pdf_files/数值分析方法.pdf" width="100%" height="550" type="application/pdf">
	</div>




      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  

  
  
  

</article>
    
    <article id="post-Notes-byhand-pde-notes" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/05/03/Notes-byhand-pde-notes/"
    >PDE-Notes</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/05/03/Notes-byhand-pde-notes/" class="article-date">
  <time datetime="2020-05-02T18:04:58.000Z" itemprop="datePublished">2020-05-03</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/notes/">notes</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <p>This is my class notes for PDE (partial differential equations ) course.</p>
<p>Due to the capacity limit, I cannot upload it (200+MB), but I found an alternative way. I uploaded it to MEGA and you can get access to the note by the following url.</p>
<p><a href="https://mega.nz/file/cdoVkDiJ#qT23xZ6WbVRNxoJ8iNsJOmXdWt_pfr5fzG3UyVoem8Q" target="_blank" rel="noopener">PDE-Note-by-Peter :)</a></p>
<p>By the way, the file seems too large so you need to wait for a moment or just download it, please execuse me.</p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  

  
  
  

</article>
    
    <article id="post-Projects-Optical-combination-experiment" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/05/03/Projects-Optical-combination-experiment/"
    >Optical Combination Experiment</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/05/03/Projects-Optical-combination-experiment/" class="article-date">
  <time datetime="2020-05-02T18:00:59.000Z" itemprop="datePublished">2020-05-03</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Projects/">Projects</a> / <a class="article-category-link" href="/categories/Projects/Optics/">Optics</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <p>This is the optical combination experiment report I’ve done in the Aplied Optical Experiment course.</p>


	<div class="row">
    <embed src="/pdf_files/光学组合实验实验报告.pdf" width="100%" height="550" type="application/pdf">
	</div>




      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  

  
  
  

</article>
    
    <article id="post-Projects-iPhone-focal-length-measurement" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/05/03/Projects-iPhone-focal-length-measurement/"
    >iPhone Focal Length Measurement</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/05/03/Projects-iPhone-focal-length-measurement/" class="article-date">
  <time datetime="2020-05-02T17:55:17.000Z" itemprop="datePublished">2020-05-03</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Projects/">Projects</a> / <a class="article-category-link" href="/categories/Projects/Optics/">Optics</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <p>This is the mobile phone focal length measurement experiment report I’ve done in the Aplied Optical Experiment course.</p>


	<div class="row">
    <embed src="/pdf_files/手机焦距测量实验报告.pdf" width="100%" height="550" type="application/pdf">
	</div>




      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  

  
  
  

</article>
    
    <article id="post-Projects-2020-ICM" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/05/02/Projects-2020-ICM/"
    >2020-ICM</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/05/02/Projects-2020-ICM/" class="article-date">
  <time datetime="2020-05-02T15:22:18.365Z" itemprop="datePublished">2020-05-02</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Projects/">Projects</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <p>This work is mainly about the football game team strategy based on big data and is our final paper for the D problem of 2020 Interdisciplinary Contest in Modelling (ICM 2020), contributed collaboratively and equally by R.C. Luo, Y.Z. Zhang and me.</p>
<p>Thanks cordially to the combined efforts of whole group, we fortunately won an M-prize. Due to privacy and copyright, the control number in our paper is erased.</p>


	<div class="row">
    <embed src="/pdf_files/2020_ICM.pdf" width="100%" height="550" type="application/pdf">
	</div>




      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  

  
  
  

</article>
    
    <article id="post-Computer-Science-Matlab学习" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/03/03/Computer-Science-Matlab%E5%AD%A6%E4%B9%A0/"
    >Matlab学习</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/03/03/Computer-Science-Matlab%E5%AD%A6%E4%B9%A0/" class="article-date">
  <time datetime="2020-03-03T08:40:36.000Z" itemprop="datePublished">2020-03-03</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Computer-Science/">Computer Science</a> / <a class="article-category-link" href="/categories/Computer-Science/Language-Learning/">Language Learning</a> / <a class="article-category-link" href="/categories/Computer-Science/Language-Learning/Matlab/">Matlab</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h1 id="matlab-学习笔记">Matlab 学习笔记</h1>
<h2 id="有关信号与系统">有关信号与系统</h2>
<h3 id="连续系统构建">连续系统构建</h3>
<figure class="highlight matlab"><table><tr><td class="code"><pre><span class="line">tf(b,a);  <span class="comment">%传递函数模型</span></span><br><span class="line">s = tf(<span class="string">'s'</span>); sys = b(s)/a(s) <span class="comment">%（具体的为多项式形式）</span></span><br><span class="line"><span class="comment">% ss 状态空间模型 （了解不多）</span></span><br><span class="line"><span class="comment">% zpk 零点-极点-增益模型 （了解不多）</span></span><br></pre></td></tr></table></figure>
<h3 id="连续系统性质研究">连续系统性质研究</h3>
<p>在用上面的方法构建好系统sys后，才可以进行下面的操作。</p>
<figure class="highlight matlab"><table><tr><td class="code"><pre><span class="line"><span class="comment">% 零极点图</span></span><br><span class="line">p = pole(sys); <span class="comment">%求出零点</span></span><br><span class="line">z = zero(sys); <span class="comment">%求出极点</span></span><br><span class="line">pzmap(sys); <span class="comment">%画零极点图 可以设置axis使之更好看</span></span><br><span class="line"></span><br><span class="line"><span class="comment">% 响应</span></span><br><span class="line">lsim(sys,u,t,x0) <span class="comment">%全响应</span></span><br><span class="line">impulse(sys); <span class="comment">%单位冲激响应</span></span><br><span class="line">step(sys); <span class="comment">%单位阶跃响应</span></span><br></pre></td></tr></table></figure>
<h2 id="有关符号表达式">有关符号表达式</h2>
<h3 id="符号声明">符号声明</h3>
<figure class="highlight matlab"><table><tr><td class="code"><pre><span class="line">syms x y; <span class="comment">%声明变量</span></span><br><span class="line">syms f(t) g(x,y); <span class="comment">%声明函数, 里面的变量可以作为符号直接使用</span></span><br><span class="line">syms A [m,n]; <span class="comment">%声明向量或矩阵 m*n维</span></span><br></pre></td></tr></table></figure>
<h3 id="符号运算">符号运算</h3>
<figure class="highlight matlab"><table><tr><td class="code"><pre><span class="line">simplify(expr); <span class="comment">%化简符号表达式</span></span><br><span class="line">root(p,x); <span class="comment">%得到符号多项式p关于x的根</span></span><br><span class="line">solve(equ,var); <span class="comment">%计算方程的解</span></span><br><span class="line">equs=[equ1 equ2]; vars=[var1 var2];</span><br><span class="line">solve(equs,vars); <span class="comment">%计算方程组equs关于变量vars的解</span></span><br><span class="line">diff(f,x,n); <span class="comment">%求符号函数f关于x的n阶导数</span></span><br><span class="line">dsolve(equ,cond); <span class="comment">%求解带diff的常微分方程 cond为初始条件</span></span><br><span class="line">dsolve(equs); <span class="comment">%求解常微分方程组 得到一组解S 用S.var 查看关于var的的解</span></span><br><span class="line">laplace(f); <span class="comment">%求关于f的拉普拉斯变换 （积分下限为0）</span></span><br><span class="line">ilaplace(F); <span class="comment">%求F的拉普拉斯逆变换</span></span><br></pre></td></tr></table></figure>
<h3 id="符号变现赋值等">符号变现（赋值等）</h3>
<figure class="highlight matlab"><table><tr><td class="code"><pre><span class="line">g = matlabFunction(f); <span class="comment">%生成一个虚拟函数句柄 将符号表达式转化为可以用句柄调用求具体值等函数</span></span><br><span class="line"></span><br><span class="line">subs(s,old,new); <span class="comment">%返回s中old全部用new代替的新的表达式, 可用于符号替换（如自变量替换）和赋值</span></span><br></pre></td></tr></table></figure>
<h2 id="其他">其他</h2>
<ul>
<li><p>函数必须以end结尾。将其保存为.m 文件，即可在其他程 序中以文件名（注意不是函数名，文件名和函数名可以不同）调用该函数。</p></li>
<li><p>关系运算</p>
<figure class="highlight matlab"><table><tr><td class="code"><pre><span class="line">a~=b<span class="comment">%不等于</span></span><br><span class="line">a&gt;=b<span class="comment">%大于等于</span></span><br><span class="line">a&lt;=b<span class="comment">%小于等于</span></span><br></pre></td></tr></table></figure></li>
<li><p>复数</p>
<figure class="highlight matlab"><table><tr><td class="code"><pre><span class="line">a=<span class="number">1</span>+<span class="number">2</span><span class="built_in">i</span></span><br><span class="line">z=<span class="built_in">real</span>(a)<span class="comment">%实部</span></span><br><span class="line">z=<span class="built_in">imag</span>(a)<span class="comment">%虚部</span></span><br><span class="line">z=<span class="built_in">angle</span>(a)<span class="comment">%辐角</span></span><br><span class="line">z=<span class="built_in">abs</span>(a)<span class="comment">%模</span></span><br><span class="line">z=<span class="built_in">conj</span>(a)<span class="comment">%共轭</span></span><br></pre></td></tr></table></figure></li>
<li><p>向量操作</p>
<figure class="highlight matlab"><table><tr><td class="code"><pre><span class="line">a=<span class="built_in">rand</span>(<span class="number">1</span>,<span class="number">3</span>)</span><br><span class="line">b=<span class="built_in">rand</span>(<span class="number">1</span>,<span class="number">3</span>)</span><br><span class="line">c=<span class="built_in">dot</span>(a,b)<span class="comment">%内积</span></span><br><span class="line">d=<span class="built_in">cross</span>(a,b)<span class="comment">%叉乘</span></span><br><span class="line">l=<span class="built_in">length</span>(a)<span class="comment">%向量长度</span></span><br><span class="line">median(a)<span class="comment">%中位数</span></span><br><span class="line">std(a)<span class="comment">%标准差</span></span><br><span class="line">s=<span class="built_in">sort</span>(a)<span class="comment">%排序</span></span><br><span class="line"><span class="comment">%还有 min max 等</span></span><br></pre></td></tr></table></figure></li>
<li><p>矩阵操作</p></li>
</ul>
<figure class="highlight matlab"><table><tr><td class="code"><pre><span class="line">a=<span class="built_in">rand</span>(<span class="number">5</span>,<span class="number">3</span>)</span><br><span class="line">b=<span class="built_in">rand</span>(<span class="number">5</span>,<span class="number">3</span>)</span><br><span class="line">b=b'<span class="comment">%转置</span></span><br><span class="line">c=a*b<span class="comment">%矩阵乘法</span></span><br><span class="line">d=a.*b<span class="comment">%逐元素相乘</span></span><br><span class="line">m=b^<span class="number">3</span><span class="comment">%幂</span></span><br><span class="line">m=b.^<span class="number">3</span><span class="comment">%点幂</span></span><br><span class="line"><span class="built_in">size</span>(b)<span class="comment">%矩阵大小</span></span><br><span class="line">b=<span class="built_in">reshape</span>(<span class="number">1</span>,<span class="number">15</span>)</span><br><span class="line">b=<span class="built_in">flipud</span>(b)<span class="comment">%上下翻转 up and down</span></span><br><span class="line">b=<span class="built_in">fliplr</span>(b)<span class="comment">%左右翻转 left and right</span></span><br><span class="line">e=<span class="built_in">diag</span>(b)<span class="comment">%取出b的对角元素</span></span><br><span class="line"></span><br><span class="line">left_division=a/b<span class="comment">% b*inv(a)</span></span><br><span class="line">right_division=a\b<span class="comment">% inv(a)*b</span></span><br><span class="line"><span class="comment">%X=A\B是方程A*X=B的解，X=A\B是方程X*A=B的解 </span></span><br><span class="line"><span class="comment">%记忆：朝向哪 逆在哪</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>绘图</p>
<figure class="highlight matlab"><table><tr><td class="code"><pre><span class="line">x=<span class="built_in">linspace</span>(<span class="number">1</span>,<span class="number">10</span>,<span class="number">100</span>)</span><br><span class="line">y1=<span class="built_in">sin</span>(x)</span><br><span class="line">y2=<span class="built_in">cos</span>(x)</span><br><span class="line">y3=<span class="built_in">tan</span>(x)</span><br><span class="line"><span class="built_in">plot</span>(x,y1,<span class="string">'blue'</span>,x,y2,<span class="string">'LineWidth'</span>,<span class="number">2</span>,<span class="string">'color'</span>,<span class="string">'red'</span>)</span><br><span class="line"><span class="comment">%要在同一图中画出多条曲线，只需将坐标依次放入plot函数即可</span></span><br><span class="line">axis([<span class="number">0</span> <span class="number">4</span>*<span class="built_in">pi</span> <span class="number">-1.2</span> <span class="number">1.2</span>])<span class="comment">%设置坐标轴范围</span></span><br><span class="line">xlim([<span class="number">1</span> <span class="number">2</span>])<span class="comment">%单独控制</span></span><br><span class="line">xlabel(<span class="string">'x'</span>); ylabel(<span class="string">'y'</span>);</span><br><span class="line"><span class="built_in">legend</span>(<span class="string">'sin(x)'</span>,<span class="string">'cos(x)'</span>);</span><br><span class="line">title(<span class="string">'Sine and Cosine Functions'</span>);</span><br><span class="line"><span class="comment">%title里可以使用latex语法</span></span><br><span class="line"><span class="comment">%如 ：title('$y_1=\sin(4\pi t+\pi /3)$','interpreter','latex')</span></span><br><span class="line"><span class="comment">% 注明解释器为latex即可</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%绘制子图</span></span><br><span class="line">subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>); <span class="built_in">plot</span>(x,y1);</span><br><span class="line">subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>); <span class="built_in">plot</span>(x,y2);</span><br><span class="line">subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>); <span class="built_in">plot</span>(x,y3);</span><br></pre></td></tr></table></figure></li>
<li><p>信号处理</p>
<figure class="highlight matlab"><table><tr><td class="code"><pre><span class="line"><span class="comment">%噪声</span></span><br><span class="line">snr=<span class="number">10</span>; <span class="comment">%Signal‐to‐noise ratio in dB.</span></span><br><span class="line">yn=awgn(y,snr,<span class="string">'measured'</span>); <span class="comment">% Add white Gaussian noise. 白噪声</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%函数</span></span><br><span class="line">k1=<span class="number">-3</span>; k2=<span class="number">3</span>; k=k1:k2; n=<span class="number">0</span>;</span><br><span class="line">step=stepfun(t,t0)<span class="comment">%t是向量形式的变量,t0表示延迟 阶跃函数</span></span><br><span class="line">delta=+(k==n) <span class="comment">% 冲激函数</span></span><br><span class="line">stem(k,delta,<span class="string">'filled'</span>)<span class="comment">% 离散函数绘制 stem为绘制杆状图</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%rectpuls和tripuls函数产生指定宽度和高度的矩形和三角脉冲。</span></span><br></pre></td></tr></table></figure></li>
<li><p>其他技巧</p>
<ul>
<li>nargin, nargout 的使用</li>
</ul></li>
</ul>
<h2 id="关于频率">关于频率</h2>
<p>采样频率 <span class="math inline">\(f_s\)</span>：每秒取 <span class="math inline">\(f_s\)</span> 个点，计算中应该取和物理采样硬件（如示波器）的采样频率一致</p>
<p>频率域分析中，若采样频率是 <span class="math inline">\(f_s\)</span>, 那么分析的范围是 <span class="math inline">\([0,f_s)\)</span>, 这是因为更高频率的波我们采样不到了。</p>
<p>又由于 <span class="math inline">\([0,f_s/2),[f_s/2,f_s)\)</span> 是对称的，事实上有用的信息或者说我们需要分析的范围是 <span class="math inline">\([0,f_s/2]\)</span> 。</p>
<p>在用 Matlab 进行频率域分析时，首先应该设置采样频率。根据物理硬件可以确定采样频率，如果是离散信号，那么采样频率就是 <span class="math inline">\(1\)</span> 。</p>
<p>第二步应该确定采样的点数 <span class="math inline">\(N\)</span> 或者采样的持续时间 <span class="math inline">\(T\)</span>, 知道一个我们就可以确定另一个：<span class="math inline">\(N\implies T=N/f_s,\quad T\implies N=T\cdot f_s\)</span></p>
<p>在使用 Matlab 的 fft 函数时，有几个需要注意的地方：</p>
<ul>
<li><p>真实信号的振幅应该是 <span class="math inline">\(A\cdot2/N\)</span> ，这个我不是很明白，查到的是这样说的，<span class="math inline">\(A\)</span> 是 fft 变换后的振幅</p></li>
<li><p>如果采样频率是 <span class="math inline">\(f_s\)</span>, 那么 fft 时要乘一下 <span class="math inline">\(dt=1/f_s\)</span> (每秒 <span class="math inline">\(f_s\)</span> 个点，那么一个点就是 <span class="math inline">\(1/f_s\)</span> 秒) ，这是由于 Matlab 的 fft 是离散傅立叶变换，相当于 <span class="math inline">\(dt=1\)</span> ，需要补乘 <span class="math inline">\(dt\)</span></p></li>
<li><p>频率域对应的频谱范围是 <span class="math inline">\(0\sim f_s\)</span>, 有用的信息是在 <span class="math inline">\(0~f_s/2\)</span>, Matlab 代码实现是</p>
<figure class="highlight matlab"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span>:(N<span class="number">-1</span>)/N*fs</span><br></pre></td></tr></table></figure>
<p>可以用 fftshift 将 <span class="math inline">\([0,f_s)\)</span> 移为 <span class="math inline">\((-f_s/2,f_s/2]\)</span>, 然后取 <span class="math inline">\([o,f_s/2]\)</span> 的有用信息进行分析</p></li>
<li><p>反变换 ifft 时要乘回来之前多乘的 <span class="math inline">\(1/f_s\)</span>, 即乘 <span class="math inline">\(f_s\)</span></p></li>
</ul>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  

  
  
  

</article>
    
    <article id="post-Physics-应用光学" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/03/02/Physics-%E5%BA%94%E7%94%A8%E5%85%89%E5%AD%A6/"
    >应用光学</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/03/02/Physics-%E5%BA%94%E7%94%A8%E5%85%89%E5%AD%A6/" class="article-date">
  <time datetime="2020-03-02T01:47:18.000Z" itemprop="datePublished">2020-03-02</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Physics/">Physics</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h1 id="应用光学-整理">应用光学 整理</h1>
<h2 id="几何光学基础">1. 几何光学基础</h2>
<ul>
<li><p>全反射 <span class="math display">\[
I=\arcsin{\frac{n_2}{n_1}}
\]</span></p></li>
<li><p>矢量形式的折射定律 <span class="math display">\[
\vec A&#39;=\vec A+P\vec N\\
\]</span> 其中： <span class="math display">\[
\begin{aligned}
P&amp;=(\vec A&#39;-\vec A)\cdot \vec N\\
&amp;=n&#39;\cos I&#39;-n\cos I\\
&amp;=\sqrt{n&#39;^2-n^2\sin ^2 I}-n\cos I
\end{aligned}
\]</span> 且 <span class="math inline">\(\vec A,\vec A’\)</span> 均为单位向量</p></li>
<li><p>矢量形式的反射定律 <span class="math display">\[
\vec A&#39;=\vec A-2(\vec N\cdot \vec A)\vec N
\]</span></p></li>
<li><p>光程</p>
<p>​ 光在介质中所经过的几何路径与该介质折射率的乘积。相当于光在介质中走过路程的时间内，在真空中所走的几何路程。 <span class="math display">\[
\notag
 s=nl=ct
\]</span></p></li>
<li><p>完善成像</p>
<p>​ 等光程上完善成像的物理条件。</p></li>
</ul>
<h2 id="球面与球面系统">2. 球面与球面系统</h2>
<h3 id="单个球面镜成像">单个球面镜成像</h3>
<ul>
<li><p>基本公式 <span class="math display">\[
\begin{aligned}
&amp;\frac{n&#39;}{l&#39;}-\frac{n}{l}=\frac{n&#39;-n}{r}\\
&amp;n&#39;u&#39;-nu=\frac{n&#39;-n}{r}h
\end{aligned}
\]</span></p></li>
<li><p>光焦度 <span class="math display">\[
\phi=\frac{n&#39;-n}{r}=\frac{n&#39;}{f&#39;}=\frac{n}{f}
\]</span></p></li>
<li><p>放大率</p>
<ul>
<li><p>横向 <span class="math display">\[
\beta=\frac{y&#39;}{y}=\frac{l&#39;-r}{l-r}=\frac{nl&#39;}{n&#39;l}
\]</span></p>
<p><span class="math inline">\(\beta&gt;0\)</span> : 虚实不同；<span class="math inline">\(\beta&lt;0\)</span> : 虚实相同。</p></li>
<li><p>轴向 <span class="math display">\[
\alpha=\frac{dl&#39;}{dl}=\frac{nl&#39;^2}{nl^2}
\]</span> 反应像与物的沿轴移动量之比。</p></li>
<li><p>角度 <span class="math display">\[
\gamma=\frac{u&#39;}{u}=\frac{l}{l&#39;}=\frac{n}{n&#39;}\frac{1}{\beta}
\]</span></p></li>
</ul></li>
<li><p>关系 <span class="math display">\[
  \alpha\gamma=\beta
  \]</span></p></li>
<li><p>不变量</p>
<ul>
<li><p>阿贝不变量 <span class="math display">\[
Q=n(\frac{1}{l}-\frac{1}{r})=n&#39;(\frac{1}{l&#39;}-\frac{1}{r&#39;})
\]</span> 阿贝不变量表征界面对某物点发出光线的偏折能力.</p></li>
<li><p>拉赫不变量</p></li>
</ul>
<p><span class="math display">\[
J=nyu=n&#39;y&#39;u&#39;
\]</span> ​ 推导： <span class="math display">\[
\notag
\beta=\frac{y&#39;}{y}=\frac{nl&#39;}{n&#39;l}=\frac{nu}{n&#39;u&#39;}\implies nyu=n&#39;y&#39;u&#39;
\]</span></p>
<p>​ <span class="math inline">\(J\)</span> 大，成像范围大，成像孔径角大，传输光能多。</p>
<p>​ 拉赫不变量表征光学系统的成像能力.</p></li>
</ul>
<h3 id="反射球面球面镜">反射球面（球面镜）</h3>
<ul>
<li><span class="math inline">\(n’=-n\)</span></li>
</ul>
<h2 id="平面和平面系统">3. 平面和平面系统</h2>
<h3 id="平面镜">平面镜</h3>
<ul>
<li>奇次反射成镜像，偶次反射成一致像</li>
<li>若反射光线不动，平面镜转 <span class="math inline">\(\alpha\)</span> 角，则反射光线转 <span class="math inline">\(2\alpha\)</span> 角</li>
</ul>
<h3 id="双平面镜">双平面镜</h3>
<ul>
<li>夹角为 <span class="math inline">\(\alpha\)</span> 的双平面镜系统，物与二次反射后所成像的夹角为 <span class="math inline">\(2\alpha\)</span> .</li>
<li>入射光线与反射光线的夹角为 <span class="math inline">\(2\alpha\)</span> .</li>
</ul>
<h3 id="平行平板">平行平板</h3>
<ul>
<li><p>近轴横向位移公式 <span class="math display">\[
\Delta l&#39;=d(1-\frac{1}{n})
\]</span></p></li>
<li><p>近轴纵向位移公式 <span class="math display">\[
\Delta t&#39;=di(1-\frac{1}{n})
\]</span> <span class="math inline">\(i\)</span> 为入射角 .</p></li>
</ul>
<h3 id="反射棱镜">反射棱镜</h3>
<ul>
<li><p>结构常数</p>
<p>​ 光轴在棱镜中的长度与棱镜通光口径之比 <span class="math display">\[
K=\frac{d}{D}
\]</span></p></li>
<li><p>五角棱镜 <span class="math display">\[
K=2+\sqrt{2}
\notag
\]</span></p></li>
<li><p>达夫棱镜 <span class="math display">\[
K=\frac{1}{\sin(45^{\circ}-i)}
\notag
\]</span></p>
<p>达夫棱镜的重要性质在于当它绕平行于反射面的轴转 <span class="math inline">\(\alpha\)</span> 角时，物体的反射像将转过 <span class="math inline">\(2\alpha\)</span> 角。</p></li>
<li><p>屋脊棱镜</p>
<p>可以增加一次反射，改变像坐标系的左右旋向。</p></li>
<li>由物坐标求像坐标
<ul>
<li>光轴方向 <span class="math inline">\(z’\)</span> 不变</li>
<li>垂直于主截面的坐标 <span class="math inline">\(x’\)</span> 视屋脊个数而定：奇数个倒转，偶数个不变。 或者：沿方向画一画确定</li>
<li><span class="math inline">\(y’\)</span> 坐标根据总反射次数而定：奇数次变左手系。</li>
</ul></li>
<li><p>角锥棱镜</p>
<ul>
<li><p>从底面以任意方向入射的光线，经三个反射面顺序反射后，以与入射光线相反的方向从底面射出。</p></li>
<li>当棱镜角以角顶为中心向任意方向偏转时，出射光线方向不变。</li>
<li>用</li>
<li><p>矢量形式的反射定律证明</p></li>
</ul></li>
</ul>
<h3 id="折射棱镜">折射棱镜</h3>
<p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcv1smbisuj30ad06t0sr.jpg" style="zoom: 67%;" /></p>
<ul>
<li><p>偏角公式 <span class="math display">\[
\sin(\frac{\alpha+\delta_{min}}{2})=n\sin\frac{\alpha}{2}
\]</span> 此时 <span class="math inline">\(I_1=-I_2’, I’_1=-I_2\)</span> .</p></li>
<li><p>近轴简化：入射角有一定大小，折射角 <span class="math inline">\(\alpha\)</span> 很小 <span class="math display">\[
\delta=\alpha\big(n\frac{\cos I&#39;_1}{\cos I_1}-1\big)
\]</span></p></li>
<li><p>近轴简化：入射角很小，折射角很小 <span class="math display">\[
\delta=(n-1)\alpha
\]</span></p></li>
</ul>
<h2 id="理想光学系统">4. 理想光学系统</h2>
<figure>
<img src="https://tva1.sinaimg.cn/large/00831rSTly1gd5cgjb5nej32720rstdm.jpg" alt="image-20200324211216424" /><figcaption>image-20200324211216424</figcaption>
</figure>
<p>​ 理想光学系统，就是能对任意宽空间内的点以任意宽的光束成完善像的光学系统。</p>
<h3 id="基本概念">（1）基本概念</h3>
<ul>
<li>主点、主平面</li>
<li>节点</li>
<li>基点</li>
<li>焦物距、焦像距</li>
<li>光焦度：折合焦距的倒数</li>
<li>视觉放大率</li>
<li>物距<span class="math inline">\(\ell\)</span> : 主点到物点到距离，像距<span class="math inline">\(\ell&#39;\)</span> : 主点到像点到距离</li>
</ul>
<h3 id="作图技巧">（2）作图技巧</h3>
<ul>
<li><p>辅助光线：</p>
<ul>
<li>平行光轴入射</li>
<li>过物方焦点入射</li>
<li>过节点入射</li>
</ul></li>
<li><p>依据：</p>
<ul>
<li><p>倾斜光轴入射的平行光束过系统后会聚雨像方焦平面</p></li>
<li><p>物方焦平面上一点发出的光束经系统后相互平行</p></li>
<li><p>光线与物方、像方主面 的交点，其高度相等</p></li>
</ul></li>
</ul>
<h3 id="公式荟萃">（3）公式荟萃</h3>
<h4 id="焦距">焦距</h4>
<p>单个光组： <span class="math display">\[
\begin{aligned}
(基本)\quad &amp;f&#39;=\frac{h}{u&#39;},\quad f=\frac{h}{u}\\
(牛顿公式)\quad &amp; xx&#39;=ff&#39;\\
(高斯公式)\quad &amp;\frac{f&#39;}{l&#39;}+\frac{f}{l}=1\\
&amp;\beta=-\frac{f}{x}=-\frac{x&#39;}{f&#39;}\\
&amp;\frac{f&#39;}{f}=-\frac{n&#39;}{n}\\
&amp; \varphi=\frac{n&#39;}{f&#39;}=-\frac{n}{f}\\
(重要推论)\quad &amp;\frac{D}{2f&#39;}=u&#39;-u
\end{aligned}
\]</span> 两个光组： <span class="math display">\[
\begin{aligned}
(牛顿公式)\quad &amp;x_F&#39;=\frac{f_2 f_2&#39;}{\Delta},x_F=\frac{f_1 f_1&#39;}{\Delta} \\
(三角形相似)\quad &amp; f&#39;=-\frac{f_1&#39; f_2&#39;}{\Delta},f=\frac{f_1 f_2}{\Delta}\\ 
&amp;\Delta=d-f_1&#39;-f_2&#39;
\end{aligned}
\]</span></p>
<p>多个光组（<span class="math inline">\(k\)</span> 个）： <span class="math display">\[
\begin{aligned}
&amp;f&#39;=\frac{h_1}{u_k&#39;}\\
(截距计算法) \quad &amp;f&#39;=\frac{l_1&#39;l_2&#39;\cdots l_l&#39;}{l_2l_3\cdots l_k}\\
\end{aligned}
\]</span></p>
<p>​ 截距计算法：令 <span class="math inline">\(l_1=-\infty\)</span> , 对每一个光组重复应用高斯公式求得物距像距，最后可推出总焦距。</p>
<p>望远镜系统： 将第二系统的焦距扩大到 <span class="math inline">\(\Gamma\)</span> 倍。（把远处物体拉近到感觉，张角变大了）</p>
<h4 id="焦物距焦像距">焦物距/焦像距</h4>
<p>牛顿公式、截距计算法。</p>
<p>单个光组： <span class="math display">\[
\begin{aligned}
&amp;xx&#39;=ff&#39;\\
&amp;\beta=-\frac{x&#39;}{f&#39;}=-\frac{f}{x}\\
(焦距-焦物距-物距)\quad &amp;x=l-f,x&#39;=l&#39;-f&#39;
\end{aligned}
\]</span></p>
<p>两个光组：</p>
<p>​ 对第一光组，焦像距 <span class="math inline">\(x&#39;=\Delta\)</span>, 对第一光组，焦物距 <span class="math inline">\(x=-\Delta\)</span> <span class="math display">\[
x_F&#39;=-\frac{f_2f_2&#39;}{\Delta},x_F=\frac{f_1f_1&#39;}{\Delta}
\notag
\]</span></p>
<h4 id="放大率">放大率</h4>
<p>$$ \begin{aligned} &amp;==-=-\ (轴向放大率)&amp; =-\ &amp;=\ (两个光组) &amp; =-=\ (重要，常用) &amp;= l=</p>
<p>\end{aligned} $$</p>
<h4 id="光焦度">光焦度</h4>
<p><span class="math display">\[
\begin{aligned}
(定义)\quad &amp;\phi=\frac{n&#39;}{f&#39;}=-\frac{n}{f}\\
(空气中,双光组)\quad &amp;\phi=\phi_1+\phi_2-d\phi_1\phi_2\\
(空气中，多光组)\quad &amp;\phi=\frac{1}{h_1}\sum_{i=1}^k h_i\phi_i
\end{aligned}
\]</span></p>
<h4 id="正切计算法">正切计算法</h4>
<p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd5bun7wn4j329a0rsjvx.jpg" alt="image-20200324211447349" style="zoom: 25%;" /></p>
<p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd5bp3fc1kj31xe0rsn21.jpg" alt="image-20200324210927813" style="zoom:25%;" /></p>
<p>顺着光路走下去。关键是一步一步地求 <span class="math inline">\(h\)</span> 和 <span class="math inline">\(u\)</span> . $$ \begin{aligned} &amp;-=u_1'-u_1=,u_2'-u_2=,, u'<em>k-u</em>{k}=\ &amp;u_i=u'<em>{i-1}\ &amp;l_i=l'</em>{i-1}-d_i h_i=h_{i-1}-d_{i-1}u'_{i-1}\</p>
<p>\end{aligned} $$</p>
<h2 id="光束限制">5. 光束限制</h2>
<h3 id="孔径光阑">孔径光阑</h3>
<p>限制孔径角</p>
<h3 id="视场光阑">视场光阑</h3>
<p>限制视场角</p>
<h3 id="渐晕光阑">渐晕光阑</h3>
<p>拦轴外光</p>
<h3 id="景深">景深</h3>
<p>见课本</p>
<h2 id="光度学基础">6. 光度学基础</h2>
<h3 id="基本术语">基本术语</h3>
<ul>
<li>以电磁辐射形式发射、传输或接收的能量：辐射能 <span class="math inline">\(Q_e\)</span></li>
<li><p>单位时间内发射、传输或接收的辐射能：辐射通量 / 辐射功率 <span class="math inline">\(\Phi_e\)</span></p></li>
<li><p>辐射通量中人眼能感受到的部分：光通量 <span class="math inline">\(\Phi_v\)</span> （单位为流明 lm ）</p></li>
<li>某一方向上单位立体角的光通量：发光强度 <span class="math inline">\(I_v\)</span> （单位为坎德拉 cd ）</li>
<li>（垂直方向）单位面积接受的光通量：光照度 <span class="math inline">\(E_v\)</span> (单位为勒克斯 lx )</li>
<li>（垂直方向）单位面积发出的光通量：光出射度 <span class="math inline">\(M_v\)</span></li>
<li><p>光源发光投影到某一方向上单位面积的发光强度：光亮度 <span class="math inline">\(L_v\)</span> （单位为尼特 nt ）</p></li>
</ul>
<p>理解：光照度表征表面接受的光的性质；光亮度表征光源的发光性质，用立体角度量，而且是单位面积，是一个比光出射度更好的光源发光性质描述。</p>
<h3 id="辅助量和联系量">辅助量和联系量</h3>
<ul>
<li>立体角
<ul>
<li><span class="math inline">\(\Omega=\displaystyle\frac{S}{r^2}\)</span></li>
<li><span class="math inline">\(d \Omega=\sin i \cdot di\cdot d\phi\)</span></li>
<li><span class="math inline">\(\Omega=\displaystyle\iint_S \sin i did\phi=(\phi_{\max}-\phi_{\min})(\cos i_{\min}-\cos i_{\max})\)</span></li>
<li>平面孔径角 <span class="math inline">\(U\)</span>, <span class="math inline">\(\Omega=\displaystyle\int_0^{2\pi}d\phi\int_0^U\sin i di=4\pi \sin^2\left(\frac U 2\right)\approx \pi u^2\)</span></li>
</ul></li>
<li><p>光谱光视效率 / 视见函数 <span class="math inline">\(V(\lambda)\)</span></p>
<p>​ 反映人眼的光谱灵敏度，表示人眼对不同波长辐射对敏感度差异。</p>
<p>​ 和辐射通量直接的换算： <span class="math inline">\(1W\)</span>（辐射通量）<span class="math inline">\(=683\cdot V(\lambda)\)</span> lm</p></li>
<li><p>发光效率 <span class="math inline">\(\eta\)</span></p>
<p>​ 辐射体发出的总光通量与该光源的耗电功率之比。</p>
<p>​ <span class="math inline">\(\eta=\displaystyle\frac{\Phi_v}{P}\)</span></p></li>
</ul>
<h3 id="重要关系">重要关系</h3>
<ul>
<li><p>光亮度 : <span class="math inline">\(L_v=\displaystyle\frac{I_v}{dA\cos i}=\frac{d\Phi_v}{d\Omega dA\cos i}\)</span></p></li>
<li><p>朗伯辐射体且面积为 <span class="math inline">\(A\)</span> : <span class="math inline">\(I_N=L_vA\)</span></p></li>
<li><p>朗伯辐射体已知光出射度或二次辐射源 : <span class="math display">\[
L_v=\frac{M_v}{\pi}=\frac{\rho E_v}{\pi}
\]</span></p></li>
</ul>
<h3 id="基本定律">基本定律</h3>
<h4 id="朗伯定律">朗伯定律</h4>
<p>一个光亮度再各个方向上均相等的发光面源（朗伯辐射体），在某一方向上的发光强度等于该面元法线方向上的发光强度与方向角余弦之积。 <span class="math display">\[
I_i=I_N\cos i
\]</span></p>
<ul>
<li><p>朗伯辐射体在孔径角 <span class="math inline">\(U\)</span> 范围内发出的光通量 <span class="math display">\[
\begin{align}
d\Phi_v&amp;=L_v\cos i dAd\Omega\notag \\
\implies \Phi_v&amp;=\int_0^{2\pi}d\phi\int_0^UL_v\sin i\cos idA di\notag \\
&amp;=\pi L_v\sin^2 U dA\\
&amp;=\pi I\sin^2 U(?)
\end{align} 
\]</span></p></li>
<li><p>孔径角为 <span class="math inline">\(\displaystyle \frac \pi 2\)</span> 时（平面），<span class="math inline">\(L_v=\displaystyle \frac{\Phi_v }{\pi dA}=\frac{M_v}{\pi}\)</span></p></li>
</ul>
<h4 id="距离平方反比定律">距离平方反比定律</h4>
<p>点光源直接照射表面时，受照面光照度为 <span class="math display">\[
E_v=\frac{I_v}{r^2}
\]</span></p>
<h4 id="照度余弦定则">照度余弦定则</h4>
<p>光源不垂直于照明面元时的光照度为 <span class="math display">\[
E_v=\frac{I_0\cos i}{r^2}=E_v\cos i
\]</span></p>
<h3 id="光束光亮度的传递">光束光亮度的传递</h3>
<ul>
<li>面光源照射时受照表面的光照度</li>
</ul>
<p><span class="math display">\[
E_v=\frac{L_v d S_1\cos i_1\cos i_2}{r^2}
\]</span></p>
<p><span class="math inline">\(i_1,i_2\)</span> 分别为两面法线与距离 <span class="math inline">\(\vec r\)</span> 直接的夹角。</p>
<ul>
<li><p>光在无损介质中传播时，各截面上的光亮度相等。</p></li>
<li><p>不同介质分界面上光束的传递 :</p></li>
</ul>
<p>$$ <span class="math display">\[\begin{align}
  \rho&amp;\approx\left(\frac{n&#39;-n}{n&#39;+n}\right)^2,\tau=1-\rho\\
  L_r&amp;=\rho L_i\\
  L_t&amp;=\left(\frac{n&#39;}{n}\right)^2\tau L_i


  \end{align}\]</span> $$</p>
<h3 id="光学成像系统的像面照度">光学成像系统的像面照度</h3>
<h4 id="轴上像点">轴上像点</h4>
<p><span class="math display">\[
\begin{align}
E_0&#39;&amp;=\frac{\Phi_v&#39;}{dS&#39;}=\tau \frac{\pi L_v \sin^2 U dS}{dS&#39;}\\
&amp;=\frac{1}{\beta^2}\tau \pi L_v\sin^2 U &amp;\text{(物空间)}\\
&amp;=\left(\frac{n&#39;}{n}\right)^2\tau\pi L_v\sin^2 U&#39; &amp;\text{(像空间)}\\
\end{align}
\]</span></p>
<p>其中用到正弦关系：<span class="math inline">\(ny\sin U=n’y’\sin U&#39;\)</span></p>
<h4 id="轴外像点">轴外像点</h4>
<p>设轴外像点 <span class="math inline">\(B’\)</span> 的像方视场角（对出瞳的张角）为 <span class="math inline">\(\omega&#39;\)</span> $$ <span class="math display">\[\begin{align}
\sin U_B&#39;&amp;\approx \sin U&#39;\cos ^2\omega\\
E_B&#39;&amp;=E_0\cos^4\omega&#39;

\end{align}\]</span> $$</p>
<h2 id="像差">7. 像差</h2>
<h3 id="概念">概念</h3>
<p>宽光束像差：球差、彗差</p>
<p>细光束像差：像散、场曲、畸变、位置色差、倍率色差</p>
<p>多看书。</p>
<h3 id="消像差">消像差</h3>
<ul>
<li>消球差：齐明透镜。球心和齐明点共点</li>
<li>消其他像差：共球心透镜。（孔径光阑放到球心处）</li>
</ul>
<h2 id="典型光学系统">8. 典型光学系统</h2>
<h3 id="眼睛">眼睛</h3>
<ul>
<li>近点、远点</li>
<li>体视</li>
</ul>
<h3 id="显微镜">显微镜</h3>
<ul>
<li><span class="math inline">\(L,\beta,x,f\)</span> 之间的公式的灵活运用</li>
<li>物体经显微物镜成像到目镜物方焦面，<span class="math inline">\(x’=\Delta\)</span></li>
<li>放大率、有效放大率</li>
<li>调节范围</li>
<li>分辨率</li>
<li>照明系统：临界照明、柯拉照明（理解共轭关系）</li>
</ul>
<h3 id="望远镜">望远镜</h3>
<ul>
<li>开普勒望远镜和伽利略望远镜以及不同的光束限制关系</li>
<li>加入转像系统（单组、双组）</li>
<li>几何焦深</li>
</ul>
<h3 id="放映系统">放映系统</h3>
<ul>
<li>光源— 聚光镜、图片— 放映物镜、光源像— 像面</li>
<li>利用图片大小之间的关系可以得到 <span class="math inline">\(\beta\)</span> , 进而求出其他</li>
<li>照度</li>
</ul>
<p>重要的事情：</p>
<h1 id="应用光学实验">应用光学实验</h1>
<h2 id="手机摄像头焦距测量">手机摄像头焦距测量</h2>
<h3 id="通用知识手机">通用知识（手机）</h3>
<ul>
<li><p>手机摄像头近似认为是薄透镜</p></li>
<li><p>视场光阑：CMOS光敏面最外面一圈</p></li>
<li><p>一般手机数值孔径：广角～1.8，数值越小难度越大；长焦～2.4，大的到2.8</p></li>
<li><p>一般手机焦距： 4～6mm</p></li>
<li><p>等效焦距</p>
<ul>
<li><p>同样焦距的镜头，在不同尺寸的感光元件上，成像视角不同，仅以镜头的物理焦距，无法比较不同相机的成像范围（视场角）。</p></li>
<li><p>为了便于比较，人们习惯将不同尺寸感光元件上成像的视角，转化为 <em>36 x 24 mm 全画幅感光元件上同样成像视角所对应的镜头焦距</em>，这个转化后的焦距就是等效焦距</p></li>
<li><p>物理焦距 <span class="math inline">\(\times\)</span> 转换系数 <span class="math inline">\(=\)</span> 等效焦距，</p>
<p>其中 转换系数 <span class="math inline">\(=\)</span> 43.27 ( 全画幅对角线长) <span class="math inline">\(/\)</span> 传感器光面对角线长</p></li>
<li><p>手机的等效焦距有个坑，1英寸手机厂商这里是 16 mm ，而不是 25.4 mm</p></li>
</ul></li>
</ul>
<h3 id="iphone-x-实验手机">iPhone X (实验手机)</h3>
<ul>
<li><p>iPhone X 后置摄像头</p>
<ul>
<li>主摄：广角 $F/1.8 $</li>
<li>副摄：长焦 <span class="math inline">\(F/2.4\)</span></li>
</ul></li>
<li><p>CMOS : IMX385 1.22 µm</p></li>
<li><p>正常拍照模式下一倍变焦用的是广角镜头，二倍变焦用的长焦镜头，人像模式下是两个镜头同时使用，后台计算像场和景深。另外，<strong>长焦镜头使用了更小的光圈，因此需要更多的光线</strong>，苹果让 iPhone 自己来判定光线是否足够，从而启动长焦镜头。</p></li>
<li><p>物方视场角 FOV：视场角分物方视场角和像方视场角。一般光学设备的使用者关心的是物方视场角。</p>
<p>对于大多数光学仪器,视场角的度量都是以成像物的直径作为视场角计算的。</p></li>
<li><p>光瞳直径 <span class="math inline">\(=\)</span> 焦距 <span class="math inline">\(/\)</span> 光圈数 <span class="math inline">\(F\)</span></p></li>
</ul>
<h3 id="实验方法">实验方法</h3>
<ul>
<li><p>找一张白纸，用直尺画上一条直线，我画的是 150 mm <span class="math inline">\(\implies l=-150\)</span></p></li>
<li><p>直线一端直立放一把尺子，另一端放手机</p></li>
<li><p>一倍正常拍摄一张，用的是主（广角）镜头；二倍数字变焦放大拍摄一张，用的是副（长焦）镜头</p></li>
<li><p>隔空投送到电脑上，用 PhotoShop 寻找尺子 1cm～2cm 的像素距离。</p>
<p>具体方法为：Ctrl+R 出现横纵坐标轴，在坐标轴上右键选像素，变成像素坐标。在 1cm～2cm 画一个矩形，记录像素距离</p></li>
<li><p>查找 CMOS 传感器的 unit cell （比如 IMX363 2.4 µm 一个像素点）, 计算实际像高</p></li>
<li><p>由 <span class="math inline">\(\displaystyle \beta=\frac{y’}{y}=\frac{l’}{l}\)</span> 得到像距 <span class="math inline">\(l’\)</span> ，有了 <span class="math inline">\(l’\)</span> 其他的都可以算了</p></li>
<li><p>焦距 <span class="math inline">\(f’=\displaystyle\frac{1}{1/l’-1/l}\)</span> （高斯公式）</p></li>
<li><p>光瞳直径 <span class="math inline">\(\displaystyle D=\frac{f’}{F}\)</span> ，<span class="math inline">\(F\)</span> 为光圈数</p></li>
<li><p>物方视场角 <span class="math inline">\(\displaystyle FOV=2\arctan\left(\frac{d/2}{l&#39;}\right)\)</span> 其中 <span class="math inline">\(d\)</span> 为传感器对角线长</p></li>
</ul>
<h3 id="实验代码">实验代码</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_l1</span><span class="params">(px, unit, y=<span class="number">10</span>)</span>:</span></span><br><span class="line">        <span class="comment"># 计算像高y1,像距l1</span></span><br><span class="line">    l = <span class="number">150</span></span><br><span class="line">    y1 = px * unit / <span class="number">1000</span></span><br><span class="line">    beta = y1 / y</span><br><span class="line">    l1 = beta * l</span><br><span class="line">    <span class="keyword">return</span> y1, l1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_f</span><span class="params">(l1, l)</span>:</span></span><br><span class="line">        <span class="comment"># 计算焦距</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> / (<span class="number">1</span> / l1 + <span class="number">1</span> / l)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_diaglen</span><span class="params">(x, y)</span>:</span></span><br><span class="line">        <span class="comment"># 获得对角线长度</span></span><br><span class="line">    <span class="keyword">return</span> np.sqrt(x**<span class="number">2</span> + y**<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_FOV</span><span class="params">(diag, l1)</span>:</span></span><br><span class="line">        <span class="comment"># 计算物方视场角</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span> * np.arctan(diag / <span class="number">2</span> / l1) * <span class="number">180</span> / np.pi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_D</span><span class="params">(f, F)</span>:</span></span><br><span class="line">        <span class="comment"># 获得光瞳直径</span></span><br><span class="line">    <span class="keyword">return</span> f / F</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">r</span><span class="params">(x, N=<span class="number">4</span>)</span>:</span></span><br><span class="line">        <span class="comment"># 保留四位小数</span></span><br><span class="line">    <span class="keyword">return</span> round(x, N)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">px1 = <span class="number">237</span></span><br><span class="line">px2 = <span class="number">432</span></span><br><span class="line">F1 = <span class="number">1.8</span></span><br><span class="line">F2 = <span class="number">2.4</span></span><br><span class="line">unit = <span class="number">1.22</span></span><br><span class="line">l = <span class="number">150</span></span><br><span class="line">diag = <span class="number">6.15</span></span><br><span class="line">trans = <span class="number">43.27</span> / diag</span><br><span class="line"></span><br><span class="line">y1, l1 = get_l1(px1, unit)</span><br><span class="line">y2, l2 = get_l1(px2, unit)</span><br><span class="line">f1 = get_f(l1, l)</span><br><span class="line">f2 = get_f(l2, l)</span><br><span class="line">D1 = get_D(f1, F1)</span><br><span class="line">D2 = get_D(f2, F2)</span><br><span class="line">FOV1 = get_FOV(diag, l1)</span><br><span class="line">FOV2 = get_FOV(diag, l2)</span><br><span class="line"><span class="comment"># diag = get_diaglen(5.21, 6.29)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print('传感器对角线长：', round(diag, 4))</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'--广角--'</span>)</span><br><span class="line">print(<span class="string">'焦距：'</span>, r(f1))</span><br><span class="line">print(<span class="string">'等效焦距'</span>, r(trans * f1))</span><br><span class="line">print(<span class="string">'物方视场角：'</span>, r(FOV1))</span><br><span class="line">print(<span class="string">'光瞳直径: '</span>, r(D1))</span><br><span class="line">print()</span><br><span class="line">print(<span class="string">'--长焦--'</span>)</span><br><span class="line">print(<span class="string">'焦距：'</span>, r(f2))</span><br><span class="line">print(<span class="string">'等效焦距'</span>, r(trans * f2))</span><br><span class="line">print(<span class="string">'物方视场角：'</span>, r(FOV2))</span><br><span class="line">print(<span class="string">'光瞳直径: '</span>, r(D2))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_err</span><span class="params">(y1)</span>:</span></span><br><span class="line">    l0 = <span class="number">1</span> / (<span class="number">1</span> / <span class="number">4</span> - <span class="number">1</span> / <span class="number">150</span>)</span><br><span class="line">    y0 = <span class="number">10</span> * l0 / <span class="number">150</span>  <span class="comment"># 10mm原像,150物距</span></span><br><span class="line">    <span class="keyword">return</span> np.abs(y0 - y1) / y0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print()</span><br><span class="line">print(<span class="string">'--误差计算--'</span>)</span><br><span class="line"></span><br><span class="line">err_y = get_err(y1)</span><br><span class="line">print(<span class="string">'像高误差-主镜头:'</span>, r(err_y) * <span class="number">100</span>, <span class="string">'%'</span>)</span><br><span class="line">print(<span class="string">'焦距误差-主镜头'</span>, r(np.abs((f1 - <span class="number">4.0</span>)) / <span class="number">4.0</span>) * <span class="number">100</span>, <span class="string">'%'</span>)</span><br><span class="line">beta1 = l1 / l</span><br><span class="line">print()</span><br><span class="line">print(<span class="string">'--放大倍率计算--'</span>)</span><br><span class="line">print(<span class="string">'横向放大倍率'</span>, r(beta1))</span><br><span class="line">print(<span class="string">'显示图像放大倍率'</span>, r(<span class="number">143.6</span> / (beta1 * <span class="number">10</span>)))</span><br></pre></td></tr></table></figure>
<h5 id="结果">结果</h5>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">--广角--</span><br><span class="line">焦距： <span class="number">4.2152</span></span><br><span class="line">等效焦距 <span class="number">29.6573</span></span><br><span class="line">物方视场角： <span class="number">70.6732</span></span><br><span class="line">光瞳直径:  <span class="number">2.3418</span></span><br><span class="line"></span><br><span class="line">--长焦--</span><br><span class="line">焦距： <span class="number">7.5098</span></span><br><span class="line">等效焦距 <span class="number">52.8373</span></span><br><span class="line">物方视场角： <span class="number">42.5086</span></span><br><span class="line">光瞳直径:  <span class="number">3.1291</span></span><br><span class="line"></span><br><span class="line">--误差计算--</span><br><span class="line">像高误差-主镜头: <span class="number">5.54</span> %</span><br><span class="line">焦距误差-主镜头 <span class="number">5.38</span> %</span><br><span class="line"></span><br><span class="line">--放大倍率计算--</span><br><span class="line">横向放大倍率 <span class="number">0.0289</span></span><br><span class="line">显示图像放大倍率 <span class="number">496.6452</span></span><br></pre></td></tr></table></figure>
<h2 id="利用单反相机测量光度学参数">利用单反相机测量光度学参数</h2>
<ol type="1">
<li><p>相机没有镜头无法成像，相机的光学传感器需要一个实像。</p></li>
<li><p>灰度值与亮度</p></li>
<li><p><span class="math inline">\(\gamma\)</span> 矫正：</p>
<ul>
<li>能量 <span class="math inline">\(=\)</span> 功率 <span class="math inline">\(\times\)</span> 时间 <span class="math inline">\(\implies\)</span> 景物亮度 <span class="math inline">\(\propto\)</span> 快门时间 ,</li>
<li>图片亮度 <span class="math inline">\(\propto\)</span> 图片灰度</li>
<li><span class="math inline">\(\implies\)</span> 图片灰度 $$ 快门时间</li>
<li>但是实际的图片灰度和快门时间是非线性的，这是由于相机对图片进行了处理</li>
<li>存储时为了压缩动态范围 做了1/2.2的处理</li>
<li>显示还原时再进行2.2的处理</li>
<li>我们做图得到灰度平方后和快门速度成正比 说明存储时做了1/2 的处理</li>
<li><a href="色彩校正中的%20gamma%20值是什么？%20-%20疾风齿轮的回答%20-%20知乎%20https://www.zhihu.com/question/27467127/answer/123239180">好的理解在此</a></li>
</ul>
<p>曝光指数 EI</p></li>
</ol>
<h2 id="应用光学讨论">应用光学讨论</h2>
<ol type="1">
<li>双目镜筒加反射棱镜，为什么加平行平板？</li>
</ol>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gep1asih0cj30sg0rsh0c.jpg" alt="image-20200512014117116" style="zoom:25%;" /></p>
<ol start="2" type="1">
<li><p>放大镜的视觉放大率是什么？或者不是什么？还是什么也不是？</p></li>
<li><p>在考虑显微镜的有效放大率的时候，人眼的最小分辨角取了<span class="math inline">\(2’\sim 4’\)</span>, 为什么取 <span class="math inline">\(2’\)</span> 到 <span class="math inline">\(4’\)</span>, 为什么有一个下限有一个上限？（相关：物理光学中的伪分辨）</p></li>
<li><p>暗视场照明可以观察小于分辨极限的微小质点，这种情况是否可以看作“超分辨”？（在直播回放appopt-10-2的1:31:00左右）</p></li>
<li><p><span class="math inline">\(50\%\)</span> 渐晕时，怎么得到的下面这个公式：</p></li>
</ol>
<p><span class="math display">\[
\tan W=\frac{p}{2\Gamma f_1^\prime+f_2^\prime+\Gamma l_p^{\prime}}
\]</span></p>
<ol start="5" type="1">
<li><p>焦距、孔径、视场为什么可以表征光学系统性能？（提示：结合拉氏不变量）</p></li>
<li><p>场镜对总光焦度无贡献，其焦距是否可随意确定？</p></li>
</ol>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  

  
  
  

</article>
    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/">上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2020
        <i class="ri-heart-fill heart_icon"></i> Longqian Huang
      </li>
    </ul>
    <ul>
      <li>
        
        
        
        Powered by <a href="https://hexo.io" target="_blank">Hexo</a>
        <span class="division">|</span>
        Theme - <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>Visitors:<span id="busuanzi_value_site_uv"></span></s>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>Views:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>

</footer>
      <div class="float_btns">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

      </div>
    </main>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/cat.png" alt="Peter&#39;s Blog"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/Projects">Projects</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/Notes">Notes</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="http://c01dkit.com" target="_blank" rel="noopener">友链</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <script>
      if (window.matchMedia("(max-width: 768px)").matches) {
        document.querySelector('.content').classList.remove('on');
        document.querySelector('.sidebar').classList.remove('on');
      }
    </script>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/lazyload.min.js"></script>

<!-- Subtitle -->

<script>
  try {
    var typed = new Typed("#subtitle", {
      strings: ['Mathematics, Computer Science, Physics . . .', '', ''],
      startDelay: 0,
      typeSpeed: 250,
      loop: true,
      backSpeed: false,
      showCursor: true
    });
  } catch (err) {
    console.log(err)
  }
</script>

<!-- Tocbot -->

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>

<!-- MathJax -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
  });

  MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for(i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.6/unpacked/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
  var ayerConfig = {
    mathjax: true
  }
</script>

<!-- Katex -->

<!-- busuanzi  -->


<script src="/js/busuanzi-2.3.pure.min.js"></script>


<!-- ClickLove -->

<!-- CodeCopy -->


<link rel="stylesheet" href="/css/clipboard.css">

<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>



    
  </div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            displayMath: [ ['$','$'], ["\\[","\\]"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js"></script>


<!-- <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['

</html>,'

</html>], ["\\(","\\)"] ],
      displayMath: [ ['$','$'], ["\\[","\\]"] ],
      processEscapes: true
    },
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js"></script> --><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>

</html>