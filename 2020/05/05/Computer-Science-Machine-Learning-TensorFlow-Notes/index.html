<!DOCTYPE html>


<html lang="en">


<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8" />
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
    TensorFlow Notes |  Peter&#39;s Blog
  </title>
  <meta name="generator" content="hexo-theme-ayer">
  
  <link rel="shortcut icon" href="/ironman.ico" />
  
  
<link rel="stylesheet" href="/dist/main.css">

  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css">

  
<link rel="stylesheet" href="/css/custom.css">

  
  
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

  
  

  

</head>

</html>

<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="app">
    <main class="content on">
      <section class="outer">
  <article id="post-Computer-Science-Machine-Learning-TensorFlow-Notes" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  TensorFlow Notes
</h1>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/05/05/Computer-Science-Machine-Learning-TensorFlow-Notes/" class="article-date">
  <time datetime="2020-05-05T13:18:07.000Z" itemprop="datePublished">2020-05-05</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Computer-Science/">Computer Science</a> / <a class="article-category-link" href="/categories/Computer-Science/Machine-Learning/">Machine Learning</a>
  </div>

      
      
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> Word count:</span>
            <span class="post-count">1.9k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> Reading time≈</span>
            <span class="post-count">9 min</span>
        </span>
    </span>
</div>

      
    </div>
    

    
    
    <div class="tocbot"></div>





    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <p>This is my notes for TensorFlow.</p>
<p>推荐网站：</p>
<ul>
<li><a href="tf.wiki">简单粗暴 TensorFlow 2</a></li>
<li><a href="https://keras.io/zh/" target="_blank" rel="noopener">Keras 中文文档</a></li>
</ul>
<h1 id="tensorflow-学习笔记">TensorFlow 学习笔记</h1>
<h2 id="数学基础部分">1. 数学基础部分</h2>
<h3 id="损失函数交叉熵">损失函数：交叉熵</h3>
<p><a href="https://blog.csdn.net/tsyccnh/article/details/79163834" target="_blank" rel="noopener">参考文章：深入理解交叉熵</a></p>
<ol type="1">
<li><p>来源 ：信息论</p></li>
<li><p>信息量:</p></li>
</ol>
<p><span class="math display">\[
I(x)=-\ln \left[p(x)\right]
\]</span></p>
<p>衡量事件 <span class="math inline">\(X=x\)</span> 包含信息的多少，发生概率越小，信息量越大。</p>
<ol start="3" type="1">
<li>信息熵：</li>
</ol>
<p><span class="math display">\[
H(X)=E\left[I(X)\right]=-\sum_{i=1}^n p(x_i)\ln\left[p(x_i)\right]
\]</span></p>
<p>事件包含的信息量的期望。</p>
<ol start="4" type="1">
<li>相对熵：KL divergence <span class="math display">\[
D_{KL}(A\| B)=-\sum_{i=1}^n p_A(x_i)\ln\left[\frac{p_A(x_i)}{p_B(x_i)}\right]
\]</span></li>
</ol>
<p><span class="math inline">\(A\)</span> 与 <span class="math inline">\(B\)</span> 之间的对数差（即是信息量的差）在 <span class="math inline">\(A\)</span> 上的期望值。</p>
<p>理解：相对熵在数学上为 <span class="math inline">\(A\)</span> 和<span class="math inline">\(B\)</span> 对数差的期望，进一步可以看成是 <strong><span class="math inline">\(B\)</span> 对<span class="math inline">\(A\)</span> 的信息量的差的期望</strong>。非常符合直觉。</p>
<ol start="5" type="1">
<li>交叉熵 <span class="math display">\[
\begin{align}
D_{KL}(A\|B)&amp;=-\sum_{i=1}^n p_A(x_i)\ln\left[p_A(x_i)\right]+\sum_{i=1}^n p_A(x_i)\ln\left[ p_B(x_i)\right]\\
&amp;=H(A)+H(A,B)
\end{align}
\]</span></li>
</ol>
<p>后一项 <span class="math inline">\(H(A,B)\)</span> 就是交叉熵： <span class="math display">\[
H(A,B)=\sum_{i=1}^np_A(x_i)\ln\left[p_B(x_i)\right]
\]</span></p>
<ol start="6" type="1">
<li>应用</li>
</ol>
<p>机器学习中，<span class="math inline">\(A\)</span> 为真实分布，<span class="math inline">\(B\)</span> 为预测分布。由于 <span class="math inline">\(A\)</span> 的信息量是不变的，相对熵中可以只关注交叉熵。交叉熵作为损失函数很好地衡量信息量的差。</p>
<p>线性回归问题中均方误差 <span class="math inline">\(MSE\)</span> 比较好用，在<strong>逻辑分类问题</strong>中交叉熵更加符合直觉。</p>
<h2 id="算法基础部分">2. 算法基础部分</h2>
<h3 id="adam">Adam</h3>
<p>待办：研究论文的数学部分</p>
<p><a href="https://blog.csdn.net/willduan1/article/details/78070086" target="_blank" rel="noopener">参考网站</a></p>
<p>理解：更好地更新权重参数</p>
<p>应用：Well suited for problems that are large in terms of data and/or parameters. The method is also appropriate for non-stationary objectives and problems with very noisy and/or sparse gradients.</p>
<h3 id="cross-validation">Cross Validation</h3>
<p>交叉验证。将数据集打乱分成 <span class="math inline">\(k\)</span> 份不相交的集合，循环训练 <span class="math inline">\(k\)</span> 次，第 <span class="math inline">\(i\)</span> 次用除了第 <span class="math inline">\(i\)</span> 集合的部分训练，用第 <span class="math inline">\(i\)</span> 集合计算损失函数，最后的损失函数为所有损失的平均。</p>
<p>待办：这种做法的合理性和优越性</p>
<p>K-fold cross-validation procedure</p>
<p class="code-caption" data-lang="ruby" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code">
<span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a>
</p>
<pre class="sourceCode ruby" id="cb1"><code class="sourceCode ruby"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># 算法伪代码</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="dt">Define</span> <span class="dt">KFoldXV</span>(D,A,L,k):</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="dt">Require</span>: D the given dataset</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="dt">Require</span>: A the learning algorithm, seen as a function that takes a dataset as input <span class="kw">and</span> outputs a learned function</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="dt">Require</span>: L the loss function, map the chosen test example to a scalar</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="dt">Require</span>: k the number of folds</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">    </a>
<a class="sourceLine" id="cb1-8" data-line-number="8">    <span class="dt">Split</span> D into k mutually exclusive subsets <span class="dt">D_i</span>, whose union is D</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">    <span class="kw">for</span> i from <span class="dv">1</span> to k <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10">    f_i = A(D\<span class="dt">D_i</span>) <span class="co"># 用第i个集合之外的训练</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11">    <span class="kw">for</span> z_j <span class="kw">in</span> <span class="dt">D_i</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12">      e_j = L(f_i,z_j) <span class="co"># 用第i个集合计算损失</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13">    <span class="kw">end</span> <span class="kw">for</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14">  <span class="kw">end</span> <span class="kw">for</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15">    <span class="dt">Return</span> e</a></code></pre>
<h3 id="lstm">LSTM</h3>
<p><a href="https://zhuanlan.zhihu.com/p/32085405" target="_blank" rel="noopener">参考</a></p>
<p>长短期记忆（Long short-term memory, LSTM）是一种特殊的RNN，主要是为了解决长序列训练过程中的梯度消失和梯度爆炸问题。</p>
<p>待办：关于激活函数 <span class="math inline">\(\tanh\)</span></p>
<h2 id="代码基础部分">3. 代码基础部分</h2>
<p>慢慢填。</p>
<h3 id="变量与常量">变量与常量</h3>
<p class="code-caption" data-lang="python" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code">
<span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a>
</p>
<pre class="sourceCode python" id="cb2"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" data-line-number="1">x <span class="op">=</span> tf.constant([[<span class="fl">1.0</span>]])</a></code></pre>
<p>注意需转化为张量（or：矩阵），外面多套一层括号。</p>
<h3 id="tf中的函数">TF中的函数</h3>
<h4 id="tf.one_hot">tf.one_hot</h4>
<p><code>tf.one_hot</code> 将输入数组转化为”one-hot“型的输出。和单分类问题有这非常密切的联系（待挖掘）。</p>
<p>比如：</p>
<p class="code-caption" data-lang="python" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code">
<span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a>
</p>
<pre class="sourceCode python" id="cb3"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="op">--</span> 输入 <span class="op">--</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">x<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">2</span>] <span class="co"># 根据输出 -1 表示不属于任何一类</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="bu">print</span>(tf.one_hot(x,depth<span class="op">=</span><span class="dv">6</span>)) <span class="co"># depth 应该是总分类数</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="op">--</span> 输出 <span class="op">--</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">tf.Tensor(</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">[[<span class="fl">1.</span> <span class="fl">0.</span> <span class="fl">0.</span> <span class="fl">0.</span> <span class="fl">0.</span> <span class="fl">0.</span>]</a>
<a class="sourceLine" id="cb3-8" data-line-number="8"> [<span class="fl">0.</span> <span class="fl">1.</span> <span class="fl">0.</span> <span class="fl">0.</span> <span class="fl">0.</span> <span class="fl">0.</span>]</a>
<a class="sourceLine" id="cb3-9" data-line-number="9"> [<span class="fl">0.</span> <span class="fl">0.</span> <span class="fl">0.</span> <span class="fl">0.</span> <span class="fl">0.</span> <span class="fl">0.</span>]</a>
<a class="sourceLine" id="cb3-10" data-line-number="10"> [<span class="fl">0.</span> <span class="fl">0.</span> <span class="fl">1.</span> <span class="fl">0.</span> <span class="fl">0.</span> <span class="fl">0.</span>]], shape<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">6</span>), dtype<span class="op">=</span>float32)</a></code></pre>
<h4 id="tf.image">tf.image</h4>
<p>用于图像处理，可以用这个扩充数据集。</p>
<p><a href="%5Bhttps://medium.com/@lufor129/tensorflow-%E5%9C%96%E7%89%87%E6%95%B8%E6%93%9A%E5%A2%9E%E5%BC%B7-%E4%BA%8C-%E5%9C%96%E7%89%87%E8%99%95%E7%90%86%E5%87%BD%E6%95%B8-1083fb176f9%5D(https://medium.com/@lufor129/tensorflow-圖片數據增強-二-圖片處理函數-1083fb176f9)">推荐/待继续研究</a></p>
<h4 id="tfds.load">tfds.load</h4>
<p>载入数据。<code>split</code> <a href="https://www.tensorflow.org/datasets/splits" target="_blank" rel="noopener">有很多玩法</a>。</p>
<p class="code-caption" data-lang="python" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code">
<span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a>
</p>
<pre class="sourceCode python" id="cb4"><code class="sourceCode python"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="im">import</span> tensorflow_datasets <span class="im">as</span> tfds</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">mnist_dataset, mnist_info <span class="op">=</span> tfda.load(<span class="st">&#39;mnist&#39;</span>,split<span class="op">=</span><span class="st">&#39;train&#39;</span>,<span class="op">\</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">               with_info<span class="op">=</span><span class="va">True</span>,batch_size<span class="op">=</span><span class="va">None</span>,<span class="op">\</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">               shuffle_files<span class="op">=</span><span class="va">True</span>, as_supvised<span class="op">=</span><span class="va">True</span>)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co"># 重要参数</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co"># split :  Which split of the data to load (e.g. &#39;train&#39;, &#39;test&#39; [&#39;train&#39;, &#39;test&#39;], &#39;train[80%:]&#39;)</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co"># shuffle_files </span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co"># as_supvised : bool, if True, the returned tf.data.Dataset will have a 2-tuple structure (input, label)</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co"># batch_size : add a batch dimension to examples</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"></a>
<a class="sourceLine" id="cb4-14" data-line-number="14">mnist_train <span class="op">=</span> mnist_dataset[<span class="st">&#39;train&#39;</span>]</a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co"># 返回迭代器(generator ) mnist_train</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="bu">print</span>(mnist_info)</a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="co"># 数据集信息</span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"><span class="op">--</span> result <span class="op">--</span></a>
<a class="sourceLine" id="cb4-21" data-line-number="21"></a>
<a class="sourceLine" id="cb4-22" data-line-number="22">tfds.core.DatasetInfo(</a>
<a class="sourceLine" id="cb4-23" data-line-number="23">    name<span class="op">=</span><span class="st">&#39;mnist&#39;</span>,</a>
<a class="sourceLine" id="cb4-24" data-line-number="24">    version<span class="op">=</span><span class="dv">3</span>.<span class="fl">0.1</span>,</a>
<a class="sourceLine" id="cb4-25" data-line-number="25">    description<span class="op">=</span><span class="st">&#39;The MNIST database of handwritten digits.&#39;</span>,</a>
<a class="sourceLine" id="cb4-26" data-line-number="26">    homepage<span class="op">=</span><span class="st">&#39;http://yann.lecun.com/exdb/mnist/&#39;</span>,</a>
<a class="sourceLine" id="cb4-27" data-line-number="27">    features<span class="op">=</span>FeaturesDict({</a>
<a class="sourceLine" id="cb4-28" data-line-number="28">        <span class="st">&#39;image&#39;</span>: Image(shape<span class="op">=</span>(<span class="dv">28</span>, <span class="dv">28</span>, <span class="dv">1</span>), dtype<span class="op">=</span>tf.uint8),</a>
<a class="sourceLine" id="cb4-29" data-line-number="29">        <span class="st">&#39;label&#39;</span>: ClassLabel(shape<span class="op">=</span>(), dtype<span class="op">=</span>tf.int64, num_classes<span class="op">=</span><span class="dv">10</span>),</a>
<a class="sourceLine" id="cb4-30" data-line-number="30">    }),</a>
<a class="sourceLine" id="cb4-31" data-line-number="31">    total_num_examples<span class="op">=</span><span class="dv">70000</span>,</a>
<a class="sourceLine" id="cb4-32" data-line-number="32">    splits<span class="op">=</span>{</a>
<a class="sourceLine" id="cb4-33" data-line-number="33">        <span class="st">&#39;test&#39;</span>: <span class="dv">10000</span>,</a>
<a class="sourceLine" id="cb4-34" data-line-number="34">        <span class="st">&#39;train&#39;</span>: <span class="dv">60000</span>,</a>
<a class="sourceLine" id="cb4-35" data-line-number="35">    },</a>
<a class="sourceLine" id="cb4-36" data-line-number="36">    supervised_keys<span class="op">=</span>(<span class="st">&#39;image&#39;</span>, <span class="st">&#39;label&#39;</span>),</a>
<a class="sourceLine" id="cb4-37" data-line-number="37">    citation<span class="op">=</span><span class="st">&quot;&quot;&quot;@article{lecun2010mnist,</span></a>
<a class="sourceLine" id="cb4-38" data-line-number="38"><span class="st">      title={MNIST handwritten digit database},</span></a>
<a class="sourceLine" id="cb4-39" data-line-number="39"><span class="st">      author={LeCun, Yann and Cortes, Corinna and Burges, CJ},</span></a>
<a class="sourceLine" id="cb4-40" data-line-number="40"><span class="st">      journal={ATT Labs [Online]. Available: http://yann. lecun. com/exdb/mnist},</span></a>
<a class="sourceLine" id="cb4-41" data-line-number="41"><span class="st">      volume=</span><span class="sc">{2}</span><span class="st">,</span></a>
<a class="sourceLine" id="cb4-42" data-line-number="42"><span class="st">      year=</span><span class="sc">{2010}</span></a>
<a class="sourceLine" id="cb4-43" data-line-number="43"><span class="st">    }&quot;&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb4-44" data-line-number="44">    redistribution_info<span class="op">=</span>,</a>
<a class="sourceLine" id="cb4-45" data-line-number="45">)</a></code></pre>
<h4 id="tf.constant_initializer">tf.constant_initializer</h4>
<p>用于初始化权重矩阵。</p>
<p>待解决：如何查看初始化的矩阵的内容</p>
<p class="code-caption" data-lang="python" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code">
<span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a>
</p>
<pre class="sourceCode python" id="cb5"><code class="sourceCode python"><a class="sourceLine" id="cb5-1" data-line-number="1">W <span class="op">=</span> np.array([[</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">    [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">-1</span>],</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">    [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>],</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">    [<span class="op">-</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">2</span>]</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">]], dtype<span class="op">=</span>np.float32)</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">kernel_initializer <span class="op">=</span> tf.constant_initializer(W)</a>
<a class="sourceLine" id="cb5-7" data-line-number="7"></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="bu">print</span>(kernel_initializer)</a>
<a class="sourceLine" id="cb5-9" data-line-number="9"></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="op">--</span> result <span class="op">--</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="op">&lt;</span>tensorflow.python.ops.init_ops_v2.Constant <span class="bu">object</span> at <span class="bn">0x135f09810</span><span class="op">&gt;</span></a></code></pre>
<h2 id="模型搭建与训练">4. 模型搭建与训练</h2>
<h3 id="线性回归">线性回归</h3>
<h4 id="搭模型">搭模型</h4>
<p class="code-caption" data-lang="python" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code">
<span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a>
</p>
<pre class="sourceCode python" id="cb6"><code class="sourceCode python"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># 模版</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw">class</span> MyModel(tf.keras.Model):</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">        <span class="bu">super</span>().<span class="fu">__init__</span>()     <span class="co"># Python 2 下使用 super(MyModel, self).__init__()</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5">        <span class="co"># 此处添加初始化代码（包含 call 方法中会用到的层），例如</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6">        <span class="co"># layer1 = tf.keras.layers.BuiltInLayer(...)</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7">        <span class="co"># layer2 = MyCustomLayer(...)</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"></a>
<a class="sourceLine" id="cb6-9" data-line-number="9">    <span class="kw">def</span> call(<span class="va">self</span>, <span class="bu">input</span>):</a>
<a class="sourceLine" id="cb6-10" data-line-number="10">        <span class="co"># 此处添加模型调用的代码（处理输入并返回输出），例如</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11">        <span class="co"># x = layer1(input)</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12">        <span class="co"># output = layer2(x)</span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13">        <span class="cf">return</span> output</a>
<a class="sourceLine" id="cb6-14" data-line-number="14"></a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="co"># 线性模型</span></a>
<a class="sourceLine" id="cb6-16" data-line-number="16"><span class="kw">class</span> Linear(tf.keras.Model):</a>
<a class="sourceLine" id="cb6-17" data-line-number="17">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb6-18" data-line-number="18">        <span class="bu">super</span>().<span class="fu">__init__</span>() <span class="co"># Python 3 直接 super(). 就可以了</span></a>
<a class="sourceLine" id="cb6-19" data-line-number="19">        <span class="co"># 全连接层 训练的参数为矩阵A和b : y = AX+b</span></a>
<a class="sourceLine" id="cb6-20" data-line-number="20">        <span class="va">self</span>.dense <span class="op">=</span> tf.keras.layers.Dense(</a>
<a class="sourceLine" id="cb6-21" data-line-number="21">            units<span class="op">=</span><span class="dv">1</span>, <span class="co"># 输出的最后一维 feature的层数</span></a>
<a class="sourceLine" id="cb6-22" data-line-number="22">            activation<span class="op">=</span><span class="va">None</span>,</a>
<a class="sourceLine" id="cb6-23" data-line-number="23">              <span class="co"># 设置 Keras 各层权重随机初始值</span></a>
<a class="sourceLine" id="cb6-24" data-line-number="24">            kernel_initializer<span class="op">=</span>tf.zeros_initializer(),</a>
<a class="sourceLine" id="cb6-25" data-line-number="25">            bias_initializer<span class="op">=</span>tf.zeros_initializer()</a>
<a class="sourceLine" id="cb6-26" data-line-number="26">        )</a>
<a class="sourceLine" id="cb6-27" data-line-number="27"></a>
<a class="sourceLine" id="cb6-28" data-line-number="28">    <span class="kw">def</span> call(<span class="va">self</span>, <span class="bu">input</span>):</a>
<a class="sourceLine" id="cb6-29" data-line-number="29">        output <span class="op">=</span> <span class="va">self</span>.dense(<span class="bu">input</span>)</a>
<a class="sourceLine" id="cb6-30" data-line-number="30">        <span class="cf">return</span> output</a></code></pre>
<h4 id="训练模型">训练模型</h4>
<p class="code-caption" data-lang="python" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code">
<span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a>
</p>
<pre class="sourceCode python" id="cb7"><code class="sourceCode python"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># 手动预处理</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">X_raw <span class="op">=</span> np.array([<span class="dv">2013</span>, <span class="dv">2014</span>, <span class="dv">2015</span>, <span class="dv">2016</span>, <span class="dv">2017</span>], dtype<span class="op">=</span>np.float32)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">y_raw <span class="op">=</span> np.array([<span class="dv">12000</span>, <span class="dv">14000</span>, <span class="dv">15000</span>, <span class="dv">16500</span>, <span class="dv">17500</span>], dtype<span class="op">=</span>np.float32)</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">X <span class="op">=</span> (X_raw <span class="op">-</span> X_raw.<span class="bu">min</span>()) <span class="op">/</span> (X_raw.<span class="bu">max</span>() <span class="op">-</span> X_raw.<span class="bu">min</span>())</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">y <span class="op">=</span> (y_raw <span class="op">-</span> y_raw.<span class="bu">min</span>()) <span class="op">/</span> (y_raw.<span class="bu">max</span>() <span class="op">-</span> y_raw.<span class="bu">min</span>())</a>
<a class="sourceLine" id="cb7-7" data-line-number="7"></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co"># 训练</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10">num_epoch <span class="op">=</span> <span class="dv">10000</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11">model <span class="op">=</span> Linear()</a>
<a class="sourceLine" id="cb7-12" data-line-number="12">optimizer <span class="op">=</span> tf.keras.optimizers.SGD(learning_rate<span class="op">=</span><span class="fl">0.01</span>)</a>
<a class="sourceLine" id="cb7-13" data-line-number="13">X <span class="op">=</span> tf.constant([X])  <span class="co"># X 是向量, [X] 是矩阵,可以转为张量</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14">y <span class="op">=</span> tf.constant([y])</a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_epoch):</a>
<a class="sourceLine" id="cb7-16" data-line-number="16">    <span class="cf">with</span> tf.GradientTape() <span class="im">as</span> tape: <span class="co"># 开始记录梯度</span></a>
<a class="sourceLine" id="cb7-17" data-line-number="17">        y_pred <span class="op">=</span> model(X)</a>
<a class="sourceLine" id="cb7-18" data-line-number="18">        loss <span class="op">=</span> tf.reduce_mean(tf.square(y_pred <span class="op">-</span> y)) </a>
<a class="sourceLine" id="cb7-19" data-line-number="19">        <span class="co"># 均方误差 reduce_mean 对所有tensor所有元素求平均</span></a>
<a class="sourceLine" id="cb7-20" data-line-number="20"></a>
<a class="sourceLine" id="cb7-21" data-line-number="21">    grads <span class="op">=</span> tape.gradient(loss, model.variables) <span class="co"># 对损失函数的每一个变量求偏导</span></a>
<a class="sourceLine" id="cb7-22" data-line-number="22">    optimizer.apply_gradients(grads_and_vars<span class="op">=</span><span class="bu">zip</span>(grads, model.variables))</a>
<a class="sourceLine" id="cb7-23" data-line-number="23">    <span class="co">#  apply_gradient 根据得到的梯度更新参数 传入一个list : [(grad_1,var_1),</span></a>
<a class="sourceLine" id="cb7-24" data-line-number="24">    <span class="co"># (grad_2,var_2),...,(grad_n,var_n)]</span></a>
<a class="sourceLine" id="cb7-25" data-line-number="25"><span class="bu">print</span>(y_pred)</a></code></pre>
<h4 id="评估模型">评估模型</h4>
<p class="code-caption" data-lang="python" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code">
<span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a>
</p>
<pre class="sourceCode python" id="cb8"><code class="sourceCode python"><a class="sourceLine" id="cb8-1" data-line-number="1">sparse_categorical_accuracy <span class="op">=</span> tf.keras.metrics.SparseCategoricalAccuracy()</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">num_batches <span class="op">=</span> <span class="bu">int</span>(data_loader.num_test_data <span class="op">//</span> batch_size)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="cf">for</span> batch_index <span class="kw">in</span> <span class="bu">range</span>(num_batches):</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">    start_index, end_index <span class="op">=</span> batch_index <span class="op">*</span> <span class="op">\</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">        batch_size, (batch_index <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> batch_size</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">    y_pred <span class="op">=</span> model.predict(data_loader.test_data[start_index: end_index])</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">    sparse_categorical_accuracy.update_state(</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">        y_true<span class="op">=</span>data_loader.test_label[start_index: end_index], y_pred<span class="op">=</span>y_pred)</a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="bu">print</span>(<span class="st">&quot;test accuracy: </span><span class="sc">%f</span><span class="st">&quot;</span> <span class="op">%</span> sparse_categorical_accuracy.result())</a></code></pre>
<h3 id="卷积神经网络">卷积神经网络</h3>
<p><code>tfwiki</code> 讲的特别好。理解卷积核<span class="math inline">\((filter)\)</span>减少参数的作用，通过滑动（卷积）扫描整个图像，过程中的权重参数是同一个核的，就是所谓的共享权重。</p>
<p>有关卷积的动态示例可以到<a href="https://github.com/vdumoulin/conv_arithmetic" target="_blank" rel="noopener">这里</a>。有时间学一下他的<code>tex</code>代码。</p>
<p class="code-caption" data-lang="python" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code">
<span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a>
</p>
<pre class="sourceCode python" id="cb9"><code class="sourceCode python"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">class</span> CNN(tf.keras.Model):</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">        <span class="bu">super</span>().<span class="fu">__init__</span>()</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">        <span class="va">self</span>.conv1 <span class="op">=</span> tf.keras.layers.Conv2D(</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">            filters<span class="op">=</span><span class="dv">32</span>,             <span class="co"># 卷积层神经元（卷积核）数目 </span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6">            kernel_size<span class="op">=</span>[<span class="dv">5</span>, <span class="dv">5</span>],     <span class="co"># 感受野大小</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">            padding<span class="op">=</span><span class="st">&#39;same&#39;</span>,         <span class="co"># padding策略（vaild 或 same）</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8">            activation<span class="op">=</span>tf.nn.relu   <span class="co"># 激活函数</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9">        )</a>
<a class="sourceLine" id="cb9-10" data-line-number="10">        <span class="va">self</span>.pool1 <span class="op">=</span> tf.keras.layers.MaxPool2D(pool_size<span class="op">=</span>[<span class="dv">2</span>, <span class="dv">2</span>], strides<span class="op">=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb9-11" data-line-number="11">        <span class="co"># 横向和纵向都是每两个取一个最大的，因此大小变化像这样：28,28 -&gt; 14,14</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12">        <span class="va">self</span>.conv2 <span class="op">=</span> tf.keras.layers.Conv2D(</a>
<a class="sourceLine" id="cb9-13" data-line-number="13">            filters<span class="op">=</span><span class="dv">64</span>,</a>
<a class="sourceLine" id="cb9-14" data-line-number="14">            kernel_size<span class="op">=</span>[<span class="dv">5</span>, <span class="dv">5</span>],</a>
<a class="sourceLine" id="cb9-15" data-line-number="15">            padding<span class="op">=</span><span class="st">&#39;same&#39;</span>, <span class="co"># &#39;same&#39; 策略保证卷积前后大小相同</span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16">            activation<span class="op">=</span>tf.nn.relu</a>
<a class="sourceLine" id="cb9-17" data-line-number="17">        )</a>
<a class="sourceLine" id="cb9-18" data-line-number="18">        <span class="va">self</span>.pool2 <span class="op">=</span> tf.keras.layers.MaxPool2D(pool_size<span class="op">=</span>[<span class="dv">2</span>, <span class="dv">2</span>], strides<span class="op">=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb9-19" data-line-number="19">        <span class="va">self</span>.flatten <span class="op">=</span> tf.keras.layers.Reshape(target_shape<span class="op">=</span>(<span class="dv">7</span> <span class="op">*</span> <span class="dv">7</span> <span class="op">*</span> <span class="dv">64</span>,))</a>
<a class="sourceLine" id="cb9-20" data-line-number="20">        <span class="va">self</span>.dense1 <span class="op">=</span> tf.keras.layers.Dense(units<span class="op">=</span><span class="dv">1024</span>, activation<span class="op">=</span>tf.nn.relu)</a>
<a class="sourceLine" id="cb9-21" data-line-number="21">        <span class="va">self</span>.dense2 <span class="op">=</span> tf.keras.layers.Dense(units<span class="op">=</span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb9-22" data-line-number="22"></a>
<a class="sourceLine" id="cb9-23" data-line-number="23">    <span class="kw">def</span> call(<span class="va">self</span>, inputs):</a>
<a class="sourceLine" id="cb9-24" data-line-number="24">        x <span class="op">=</span> <span class="va">self</span>.conv1(inputs)                  <span class="co"># [batch_size, 28, 28, 32]</span></a>
<a class="sourceLine" id="cb9-25" data-line-number="25">        x <span class="op">=</span> <span class="va">self</span>.pool1(x)                       <span class="co"># [batch_size, 14, 14, 32]</span></a>
<a class="sourceLine" id="cb9-26" data-line-number="26">        x <span class="op">=</span> <span class="va">self</span>.conv2(x)                       <span class="co"># [batch_size, 14, 14, 64]</span></a>
<a class="sourceLine" id="cb9-27" data-line-number="27">        x <span class="op">=</span> <span class="va">self</span>.pool2(x)                       <span class="co"># [batch_size, 7, 7, 64]</span></a>
<a class="sourceLine" id="cb9-28" data-line-number="28">        x <span class="op">=</span> <span class="va">self</span>.flatten(x)                     <span class="co"># [batch_size, 7 * 7 * 64]</span></a>
<a class="sourceLine" id="cb9-29" data-line-number="29">        x <span class="op">=</span> <span class="va">self</span>.dense1(x)                      <span class="co"># [batch_size, 1024]</span></a>
<a class="sourceLine" id="cb9-30" data-line-number="30">        x <span class="op">=</span> <span class="va">self</span>.dense2(x)                      <span class="co"># [batch_size, 10]</span></a>
<a class="sourceLine" id="cb9-31" data-line-number="31">        output <span class="op">=</span> tf.nn.softmax(x)</a>
<a class="sourceLine" id="cb9-32" data-line-number="32">        <span class="cf">return</span> output</a></code></pre>
<p>待看：</p>
<p class="code-caption" data-lang="python" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code">
<span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a>
</p>
<pre class="sourceCode python" id="cb10"><code class="sourceCode python"><a class="sourceLine" id="cb10-1" data-line-number="1">kernel_initializer<span class="op">=</span>tf.constant_initializer(W),</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">bias_initializer<span class="op">=</span>tf.constant_initializer(b)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">      </a>
<a class="sourceLine" id="cb10-4" data-line-number="4"></a>
<a class="sourceLine" id="cb10-5" data-line-number="5">dataset <span class="op">=</span> dataset.<span class="bu">map</span>(<span class="kw">lambda</span> img, label: (tf.image.resize(img, [<span class="dv">224</span>, <span class="dv">224</span>]) <span class="op">/</span> <span class="fl">255.0</span>, label)).shuffle(<span class="dv">1024</span>).batch(<span class="dv">32</span>)</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">model <span class="op">=</span> tf.keras.applications.MobileNetV2(weights<span class="op">=</span><span class="va">None</span>, classes<span class="op">=</span><span class="dv">5</span>)</a></code></pre>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
        <div class="declare">
          <ul class="post-copyright">
            <li>
              <i class="ri-copyright-line"></i>
              <strong>Copyright： </strong>
              Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source.
            </li>
          </ul>
        </div>
        
    <footer class="article-footer">
      
          
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        分享
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://longqianh.com/2020/05/05/Computer-Science-Machine-Learning-TensorFlow-Notes/" alt="微信分享二维码">
    </div>
</div>

<div id="share-mask"></div>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TensorFlow/" rel="tag">TensorFlow</a></li></ul>


    </footer>

  </div>

  
  
  <nav class="article-nav">
    
      <a href="/2020/05/23/Life-%E4%B8%80%E4%BA%9B%E5%BF%83%E5%BE%97/" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            一些心得
          
        </div>
      </a>
    
    
      <a href="/2020/05/03/Projects-Laser-holography/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">Laser Holography</div>
      </a>
    
  </nav>


  

  

  
  
  
  
  

</article>
</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2020
        <i class="ri-heart-fill heart_icon"></i> Longqian Huang
      </li>
    </ul>
    <ul>
      <li>
        
        
        
        Powered by <a href="https://hexo.io" target="_blank">Hexo</a>
        <span class="division">|</span>
        Theme - <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>Visitors:<span id="busuanzi_value_site_uv"></span></s>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>Views:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>

</footer>
      <div class="float_btns">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

      </div>
    </main>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/cat.png" alt="Peter&#39;s Blog"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/Projects">Projects</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/Notes">Notes</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="http://c01dkit.com" target="_blank" rel="noopener">友链</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <script>
      if (window.matchMedia("(max-width: 768px)").matches) {
        document.querySelector('.content').classList.remove('on');
        document.querySelector('.sidebar').classList.remove('on');
      }
    </script>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/lazyload.min.js"></script>

<!-- Subtitle -->

<script>
  try {
    var typed = new Typed("#subtitle", {
      strings: ['Mathematics, Computer Science, Physics . . .', '', ''],
      startDelay: 0,
      typeSpeed: 250,
      loop: true,
      backSpeed: false,
      showCursor: true
    });
  } catch (err) {
    console.log(err)
  }
</script>

<!-- Tocbot -->


<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: '.tocbot',
    contentSelector: '.article-entry',
    headingSelector: 'h1, h2, h3, h4, h5, h6',
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: 'main',
    positionFixedSelector: '.tocbot',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto'
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>

<!-- MathJax -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
  });

  MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for(i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.6/unpacked/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
  var ayerConfig = {
    mathjax: true
  }
</script>

<!-- Katex -->

<!-- busuanzi  -->


<script src="/js/busuanzi-2.3.pure.min.js"></script>


<!-- ClickLove -->

<!-- CodeCopy -->


<link rel="stylesheet" href="/css/clipboard.css">

<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>



    
  </div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            displayMath: [ ['$','$'], ["\\[","\\]"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js"></script>


<!-- <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['

</html>,'

</html>], ["\\(","\\)"] ],
      displayMath: [ ['$','$'], ["\\[","\\]"] ],
      processEscapes: true
    },
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js"></script> --><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>

</html>